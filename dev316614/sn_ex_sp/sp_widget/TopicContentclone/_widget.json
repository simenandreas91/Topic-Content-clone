{
    "instance": {
        "name": "dev316614",
        "url": "https://dev316614.service-now.com",
        "g_ck": "807fac71c3fd32506b68770d0501311ee33402e20664e8b5c83c08be120cf9bb0a597873"
    },
    "action": "saveWidget",
    "tableName": "sp_widget",
    "name": "Topic Content clone",
    "sys_id": "6c37f079c33172506b68770d050131ee",
    "widget": {
        "template": {
            "sys_mandatory": false,
            "visible": true,
            "dbType": -1,
            "label": "Body HTML template",
            "sys_readonly": false,
            "type": "html_template",
            "mandatory": false,
            "displayValue": "<div class=\"browse-content-container\">\n  <div ng-class=\"data.isMobileApp ? 'browse-elevation-mobile': 'browse-elevation'\" ng-if = \"contentItems.length > 0 || data.showEmptyState === 'true'\">\n\n    <div class=\"box-header-title\">\n      <h3 class=\"title-item\">{{data.widgetTitle}}</h3>\n    </div>\n\n    <div class=\"box-header-title p-v-2\">\n      <div ng-if=\"!data.isMobileApp\" class=\"title-item-filters\"\n        ng-class=\"{'item-fitlers-disable': (contentItems.length === 0 && data.filterBy ==='')}\">\n        <div class=\"flex-mobile m-r-auto\" ng-if=\"isSearchModeEnabled\">\n          <label class=\"label-padding\" for=\"filter_picker_select\">${Filter by}</label>\n          <select id=\"filter_picker_select\" ng-disabled=\"contentItems.length === 0 && data.filterBy ===''\"\n            class=\"form-control\" name=\"filter_picker_select\" ng-model=\"data.aisFilterBy\" title=\"${Filter by}\"\n            ng-change=\"getUpdatedContent()\" aria-label=\"${Filter by}\"\n            ng-options=\"item.sysId as item.name for item in aisFilterOptions\" />\n        </div>\n\n        <div class=\"flex-mobile m-r-auto\" ng-if=\"!isSearchModeEnabled\">\n          <label class=\"label-padding\" for=\"filter_picker_select\">${Filter by}</label>\n          <select id=\"filter_picker_select\" ng-disabled=\"contentItems.length === 0 && data.filterBy ===''\"\n            class=\"form-control\" name=\"filter_picker_select\" ng-model=\"data.filterBy\" title=\"${Filter by}\"\n            ng-change=\"getUpdatedContent()\" aria-label=\"${Filter by}\"\n            ng-options=\"item.sysId as item.name for item in data.filterOptions\" />\n        </div>\n\n        <div class=\"flex-mobile filter-search\">\n          <div class=\"flex-mobile\" ng-if=\"isSearchModeEnabled\" ng-class=\"{'filter-padding' : !data.aisEnabledUtah}\">\n            <label class=\"label-padding\" for=\"sort_picker_select\">${Sort by}</label>\n            <select id=\"sort_picker_select\" class=\"form-control\"\n              ng-disabled=\"contentItems.length === 0 && data.filterBy ===''\" name=\"sort_picker_select\"\n              ng-model=\"data.aisSortBy\" ng-change=\"getUpdatedContent()\"\n              ng-options=\"item.id as item.name for item in aisSortOptions\" />\n          </div>\n          <div class=\"flex-mobile\" ng-if=\"data.profileLang == 'en' && !isSearchModeEnabled\" ng-class=\"{'filter-padding' : !data.aisEnabledUtah}\">\n            <label class=\"label-padding\" for=\"sort_picker_select\">${Sort by}</label>\n            <select id=\"sort_picker_select\" class=\"form-control\"\n              ng-disabled=\"contentItems.length === 0 && data.filterBy ===''\" name=\"sort_picker_select\"\n              ng-model=\"data.sortBy\" ng-change=\"getUpdatedContent()\"\n              ng-options=\"item.id as item.name for item in data.sortOptions\" />\n          </div>\n          <div ng-if=\"data.aisEnabledUtah\">\n            <widget id=\"ais_topic_search\" options='data.searchWidgetInitOptions'>\n            </widget>\n          </div>\n          <div class=\"view-controls\" ng-if=\"!data.isMobile\">\n            <div class=\"pull-right padder-t-sm text-lg toggle\" role=\"group\" aria-label=\"${Select a view}\">\n              <button id=\"tab-card\" ng-disabled=\"contentItems.length === 0 && data.filterBy ===''\" class=\"fa fa-th btn\"\n                ng-click=\"changeView('card')\" ng-keydown=\"switchTab($event)\" ng-class=\"data.view == 'card' ? 'btn-primary' : 'btn-default'\"\n                title=\"${Card View}\" data-toggle=\"{{!isTouchDevice() ? 'tooltip' : undefined}}\" data-placement=\"top\"\n                data-container=\"body\" aria-label=\"${Card View}\"\n                ng-attr-aria-controls=\"{{data.view == 'card' ? 'tabpanel-card-' + (data.sys_id ? data.sys_id : '') : undefined}}\"\n                aria-pressed=\"{{data.view == 'card'}}\"></button>\n              <button id=\"tab-list\" ng-disabled=\"contentItems.length === 0 && data.filterBy ===''\" class=\"fa fa-list-ul btn\"\n                ng-click=\"changeView('list')\" ng-keydown=\"switchTab($event)\" ng-class=\"data.view == 'list' ? 'btn-primary' : 'btn-default'\"\n                title=\"${List View}\" data-toggle=\"{{!isTouchDevice() ? 'tooltip' : undefined}}\" data-placement=\"top\"\n                data-container=\"body\" aria-label=\"${List View}\"\n                ng-attr-aria-controls=\"{{ data.view == 'list' || data.isMobileApp ? 'tabpanel-list-' + (data.sys_id ? data.sys_id : '') : undefined}}\"\n                aria-pressed=\"{{data.view == 'list'}}\"></button>\n            </div>\n          </div>\n        </div>\n      </div>\n      <div ng-if=\"data.isMobileApp\" class=\"title-item-filters\"\n        ng-class=\"{'item-fitlers-disable': (contentItems.length === 0 && data.filterBy ==='')}\">\n        \n        <div class=\"flex-mobile form-inline\" ng-if=\"!isSearchModeEnabled\">\n          <label class=\"aisearch-mobile-weight\" for=\"filter_picker_select\">${Filter by}</label>\n          <select  id=\"filter_picker_select\" ng-disabled=\"contentItems.length === 0 && data.filterBy ===''\"\n          class=\"sn-select-basic full-width-drop-down\" name=\"filter_picker_select\" ng-model=\"data.filterBy\" title=\"${Filter by}\"\n            ng-change=\"getUpdatedContent()\" aria-label=\"${Filter by}\">\n            <option ng-repeat=\"item in data.filterOptions\" value={{::item.sysId}}>{{::item.name}}</option>\n          </select>\n        </div>\n        \n        <div class=\"flex-mobile form-inline\" ng-if=\"isSearchModeEnabled\">\n          <label class=\"aisearch-mobile-weight\" for=\"filter_picker_select\">${Filter by}</label>\n          <select id=\"filter_picker_select\" ng-disabled=\"contentItems.length === 0 && data.filterBy ===''\"\n          class=\"sn-select-basic full-width-drop-down\" name=\"filter_picker_select\" ng-model=\"data.aisFilterBy\" title=\"${Filter by}\"\n            ng-change=\"getUpdatedContent()\" aria-label=\"${Filter by}\">\n            <option ng-repeat=\"item in aisFilterOptions\" value={{::item.sysId}}>{{::item.name}}</option>\n          </select>\n        </div>\n        \n        <div class=\"flex-mobile form-inline\" ng-if=\"isSearchModeEnabled\">\n          <label class=\"aisearch-mobile-weight\" for=\"sort_picker_select\">${Sort by}</label>\n          <select id=\"sort_picker_select\" class=\"sn-select-basic full-width-drop-down\"\n            ng-disabled=\"contentItems.length === 0 && data.filterBy ===''\" name=\"sort_picker_select\"\n\t\t\t      ng-model=\"data.aisSortBy\" ng-change=\"getUpdatedContent()\">\n            <option ng-repeat=\"item in aisSortOptions\" value={{::item.id}}>{{::item.name}}</option>\n\n        </select>\n        </div>\n        \n        <div class=\"flex-mobile form-inline\" ng-if=\"data.profileLang == 'en' && !isSearchModeEnabled\">\n          <label class=\"aisearch-mobile-weight\" for=\"sort_picker_select\">${Sort by}</label>\n          <select id=\"sort_picker_select\" class=\"sn-select-basic full-width-drop-down\"\n\t\t\tng-disabled=\"contentItems.length === 0 && data.filterBy ===''\" name=\"sort_picker_select\"\n\t\t\tng-model=\"data.sortBy\" ng-change=\"getUpdatedContent()\">\n      <option ng-repeat=\"item in data.sortOptions\" value={{::item.id}}>{{::item.name}}</option>\n    </select>\n          </div>\n        <div ng-if=\"data.aisEnabledUtahMobile && contentItems.length > 0\" class=\"aiseach-mobile-padding\">\n            <widget id=\"ais_topic_search\" options='data.searchWidgetInitOptions'>\n            </widget>\n          </div>\n      </div>\n    </div>\n\n    <div class=\"box-header-title spellcheck-container\" ng-class=\"{'aiseach-mobile-spellcheck-adjust': data.isMobileApp}\" ng-if=\"isSearchModeEnabled\" aria-live=\"polite\">\n      <div class=\"search-results-container\" ng-if=\"searchedTerm && spellCorrectedTerm && !loading\">\n        <div ng-if=\"spellCorrectedTerm && !data.isMobileApp\">${Showing results for}<button class=\"btn-link\" ng-click=\"handleCorrectedSearch(spellCorrectedTerm, 'spell-corrected-term')\">{{spellCorrectedTerm}}</button>\n        </div>\n        <div ng-if=\"searchedTerm && !data.isMobileApp\">${Search instead for}<button class=\"btn-link\" ng-click=\"handleCorrectedSearch(searchedTerm, 'search-term')\">{{searchedTerm}}</button></div>\n      </div>\n      <div ng-if=\"!data.isMobileApp\" class=\"clear-search-container\">\n        <button class=\"btn btn-link\" ng-click=\"clearSearch()\">{{::data.clearSearchBtn}}</button>\n      </div>\n      <i ng-if=\"data.isMobileApp\" ng-click=\"clearSearch()\" class=\"fa fa-times-circle fa-lg aisearch-reset-blend\" aria-label=\"${Reset Search}\"></i>\n    </div>\n\n    <div aria-live=\"polite\" class=\"sr-only\">\n      <span ng-if=\"isSearchModeEnabled\">\n        <span ng-if=\"loading\">${Loading new items}</span>\n        <span ng-if=\"!loading && noOfNewItems > 0\">{{newItemsAnnouncement}}</span>\n        <span ng-if=\"!loading && noOfNewItems == 0\">${No results match your criteria}</span>\n      </span>\n    </div>\n\n    <ul\n      id=\"{{ data.view == 'list' || data.isMobileApp ? 'tabpanel-list-' + data.sys_id  : 'tabpanel-card-' + data.sys_id }}\"\n      class=\"grid-margin\" ng-class=\"data.view == 'list' || data.isMobileApp ? 'list-view-block': 'grid-test-auto-wrap'\">\n      <li ng-if=\"!loading || data.action ==='show-more' || data.action === 'modify-ais-results'\" class=\"flex-item-card\"\n        ng-class=\"data.view == 'list' ? 'list-view': ''\" ng-repeat=\"item in getContentItems(); track by item.sys_id\"\n        on-finish-repeat=\"ngRepeatFinishedContentCards\">\n        <span ng-if=\"isSearchModeEnabled\" id=\"count_{{item.content}}\" class=\"aria-labelled-by-hidden\">${Item {{$index + 1}} of {{aisContentItems.length}}, }</span>\n        <span ng-if=\"!isSearchModeEnabled\" id=\"count_{{item.content}}\" class=\"aria-labelled-by-hidden\">${Item {{$index + 1}} of {{data.content.length}}, }</span>\n        <div class=\"flex-display\">\n          <sp-widget widget=\"item.widgetData\"></sp-widget>\n        </div>\n      </li>\n      <li ng-if=\"loading\" class=\"flex-item-card skeleton-loading\" ng-class=\"data.view == 'list' ? 'list-view': ''\"\n        ng-repeat=\"item in [1,2,3,4,5,6,7,8,9,10,11,12]\">\n        <span class=\"skeleton-loader badge-loader\"></span>\n        <div class=\"flex-column text-items\">\n          <div class=\"skeleton-loader title-loader\"></div>\n          <div class=\"skeleton-loader description-loader\"></div>\n          <div class=\"skeleton-loader additional-info-loader\"></div>\n          <div class=\"empty\"></div>\n        </div>\n      </li>\n    </ul>\n    <div ng-if=\"!isSearchModeEnabled\">\n      <div class=\"content-align-center\" ng-if=\"data.filterBy !=='' && contentItems.length === 0\">\n        <img src=\"5c50c822c3e930102ec1a589a840dd7b.iix\" />\n        <p ng-bind-html=\"data.noContentMessage\">\n        </p>\n        <p>\n          ${Try another search or remove some filters.}\n        </p>\n      </div>\n      <div class=\"content-align-center\" ng-if=\"(!data.isMobileApp && contentItems.length === 0 && data.filterBy ==='')\">\n        <img src=\"5c50c822c3e930102ec1a589a840dd7b.iix\" />\n        <p>\n          ${No content available}\n        </p>\n      </div>\n      <div class=\"content-align-center\" ng-if=\"(data.isMobileApp && contentItems.length === 0 && data.filterBy ==='')\"\n        ng-bind-html=\"data.mobileNoContentMessage\" />\n      <div ng-if=\"data.showMore\">\n        <button class=\"btn btn-default btn-loadmore\" ng-click=\"loadMore()\" ng-keydown=\"loadMoreKeydown($event)\">\n          {{data.showMoreMsg}}\n        </button>\n      </div>\n    </div>\n\n    <div ng-if=\"isSearchModeEnabled\">\n      <div ng-if=\"data.isMobileApp ? showMoreFlagMobileSearch : hasNext\">\n        <button class=\"btn btn-default btn-loadmore\" ng-click=\"loadMore()\" ng-keydown=\"loadMoreKeydown($event)\">\n          ${Show more}\n        </button>\n      </div>\n      <div ng-if=\"data.showRedirectToGlobal && aisContentItems.length !== 0 && !data.isMobileApp\">\n        <div ng-include=\"'sn-ec-global-search-redirect'\" class=\"content-align-center expand-search-container\"></div>\n\n      </div>\n      <div ng-if=\"aisContentItems.length === 0 && !loading\" class=\"content-align-center search-no-results-container\">\n        <i ng-if=\"!data.isMobileApp\" class=\"fa fa-search\"></i>\n        <img ng-if=\"data.isMobileApp\"\n           ng-src={{c.data.mespEmptyStateImage}}\n           class=\"mesp-image-resize\">\n        <h4 ng-if=\"!data.isMobileApp\">${No results match your criteria.}</h4>\n        <h4 ng-if=\"data.isMobileApp\">${No results match your criteria}</h4>\n        <div ng-if=\"!data.isMobileApp\">\n          <p>${You might find more results with a global search.}</p>\n          <a ng-if=\"data.showRedirectToGlobal\" class=\"btn btn-primary\" role=\"button\" ng-href=\"{{getExpandSearchURL()}}\"\n            aria-labelledby=\"{{data.expandSearchLink}}\" title=\"{{data.expandSearchLink}}\" ng-click=\"setSessionData()\">\n            ${Expand your search}\n            <span class=\"sr-only\" id=\"{{data.expandSearchLink}}-ext-link}\" ng-if=\"(item.target == '_blank')\">${, opens\n              in a new window}\n            </span>\n          </a>\n        </div>\n      \n      </div>\n    </div>\n  </div>\n</div>",
            "readonly": false,
            "hint": "",
            "name": "template",
            "attributes": {},
            "choice": 0,
            "value": "<div class=\"browse-content-container\">\n  <div ng-class=\"data.isMobileApp ? 'browse-elevation-mobile': 'browse-elevation'\" ng-if = \"contentItems.length > 0 || data.showEmptyState === 'true'\">\n\n    <div class=\"box-header-title\">\n      <h3 class=\"title-item\">{{data.widgetTitle}}</h3>\n    </div>\n\n    <div class=\"box-header-title p-v-2\">\n      <div ng-if=\"!data.isMobileApp\" class=\"title-item-filters\"\n        ng-class=\"{'item-fitlers-disable': (contentItems.length === 0 && data.filterBy ==='')}\">\n        <div class=\"flex-mobile m-r-auto\" ng-if=\"isSearchModeEnabled\">\n          <label class=\"label-padding\" for=\"filter_picker_select\">${Filter by}</label>\n          <select id=\"filter_picker_select\" ng-disabled=\"contentItems.length === 0 && data.filterBy ===''\"\n            class=\"form-control\" name=\"filter_picker_select\" ng-model=\"data.aisFilterBy\" title=\"${Filter by}\"\n            ng-change=\"getUpdatedContent()\" aria-label=\"${Filter by}\"\n            ng-options=\"item.sysId as item.name for item in aisFilterOptions\" />\n        </div>\n\n        <div class=\"flex-mobile m-r-auto\" ng-if=\"!isSearchModeEnabled\">\n          <label class=\"label-padding\" for=\"filter_picker_select\">${Filter by}</label>\n          <select id=\"filter_picker_select\" ng-disabled=\"contentItems.length === 0 && data.filterBy ===''\"\n            class=\"form-control\" name=\"filter_picker_select\" ng-model=\"data.filterBy\" title=\"${Filter by}\"\n            ng-change=\"getUpdatedContent()\" aria-label=\"${Filter by}\"\n            ng-options=\"item.sysId as item.name for item in data.filterOptions\" />\n        </div>\n\n        <div class=\"flex-mobile filter-search\">\n          <div class=\"flex-mobile\" ng-if=\"isSearchModeEnabled\" ng-class=\"{'filter-padding' : !data.aisEnabledUtah}\">\n            <label class=\"label-padding\" for=\"sort_picker_select\">${Sort by}</label>\n            <select id=\"sort_picker_select\" class=\"form-control\"\n              ng-disabled=\"contentItems.length === 0 && data.filterBy ===''\" name=\"sort_picker_select\"\n              ng-model=\"data.aisSortBy\" ng-change=\"getUpdatedContent()\"\n              ng-options=\"item.id as item.name for item in aisSortOptions\" />\n          </div>\n          <div class=\"flex-mobile\" ng-if=\"data.profileLang == 'en' && !isSearchModeEnabled\" ng-class=\"{'filter-padding' : !data.aisEnabledUtah}\">\n            <label class=\"label-padding\" for=\"sort_picker_select\">${Sort by}</label>\n            <select id=\"sort_picker_select\" class=\"form-control\"\n              ng-disabled=\"contentItems.length === 0 && data.filterBy ===''\" name=\"sort_picker_select\"\n              ng-model=\"data.sortBy\" ng-change=\"getUpdatedContent()\"\n              ng-options=\"item.id as item.name for item in data.sortOptions\" />\n          </div>\n          <div ng-if=\"data.aisEnabledUtah\">\n            <widget id=\"ais_topic_search\" options='data.searchWidgetInitOptions'>\n            </widget>\n          </div>\n          <div class=\"view-controls\" ng-if=\"!data.isMobile\">\n            <div class=\"pull-right padder-t-sm text-lg toggle\" role=\"group\" aria-label=\"${Select a view}\">\n              <button id=\"tab-card\" ng-disabled=\"contentItems.length === 0 && data.filterBy ===''\" class=\"fa fa-th btn\"\n                ng-click=\"changeView('card')\" ng-keydown=\"switchTab($event)\" ng-class=\"data.view == 'card' ? 'btn-primary' : 'btn-default'\"\n                title=\"${Card View}\" data-toggle=\"{{!isTouchDevice() ? 'tooltip' : undefined}}\" data-placement=\"top\"\n                data-container=\"body\" aria-label=\"${Card View}\"\n                ng-attr-aria-controls=\"{{data.view == 'card' ? 'tabpanel-card-' + (data.sys_id ? data.sys_id : '') : undefined}}\"\n                aria-pressed=\"{{data.view == 'card'}}\"></button>\n              <button id=\"tab-list\" ng-disabled=\"contentItems.length === 0 && data.filterBy ===''\" class=\"fa fa-list-ul btn\"\n                ng-click=\"changeView('list')\" ng-keydown=\"switchTab($event)\" ng-class=\"data.view == 'list' ? 'btn-primary' : 'btn-default'\"\n                title=\"${List View}\" data-toggle=\"{{!isTouchDevice() ? 'tooltip' : undefined}}\" data-placement=\"top\"\n                data-container=\"body\" aria-label=\"${List View}\"\n                ng-attr-aria-controls=\"{{ data.view == 'list' || data.isMobileApp ? 'tabpanel-list-' + (data.sys_id ? data.sys_id : '') : undefined}}\"\n                aria-pressed=\"{{data.view == 'list'}}\"></button>\n            </div>\n          </div>\n        </div>\n      </div>\n      <div ng-if=\"data.isMobileApp\" class=\"title-item-filters\"\n        ng-class=\"{'item-fitlers-disable': (contentItems.length === 0 && data.filterBy ==='')}\">\n        \n        <div class=\"flex-mobile form-inline\" ng-if=\"!isSearchModeEnabled\">\n          <label class=\"aisearch-mobile-weight\" for=\"filter_picker_select\">${Filter by}</label>\n          <select  id=\"filter_picker_select\" ng-disabled=\"contentItems.length === 0 && data.filterBy ===''\"\n          class=\"sn-select-basic full-width-drop-down\" name=\"filter_picker_select\" ng-model=\"data.filterBy\" title=\"${Filter by}\"\n            ng-change=\"getUpdatedContent()\" aria-label=\"${Filter by}\">\n            <option ng-repeat=\"item in data.filterOptions\" value={{::item.sysId}}>{{::item.name}}</option>\n          </select>\n        </div>\n        \n        <div class=\"flex-mobile form-inline\" ng-if=\"isSearchModeEnabled\">\n          <label class=\"aisearch-mobile-weight\" for=\"filter_picker_select\">${Filter by}</label>\n          <select id=\"filter_picker_select\" ng-disabled=\"contentItems.length === 0 && data.filterBy ===''\"\n          class=\"sn-select-basic full-width-drop-down\" name=\"filter_picker_select\" ng-model=\"data.aisFilterBy\" title=\"${Filter by}\"\n            ng-change=\"getUpdatedContent()\" aria-label=\"${Filter by}\">\n            <option ng-repeat=\"item in aisFilterOptions\" value={{::item.sysId}}>{{::item.name}}</option>\n          </select>\n        </div>\n        \n        <div class=\"flex-mobile form-inline\" ng-if=\"isSearchModeEnabled\">\n          <label class=\"aisearch-mobile-weight\" for=\"sort_picker_select\">${Sort by}</label>\n          <select id=\"sort_picker_select\" class=\"sn-select-basic full-width-drop-down\"\n            ng-disabled=\"contentItems.length === 0 && data.filterBy ===''\" name=\"sort_picker_select\"\n\t\t\t      ng-model=\"data.aisSortBy\" ng-change=\"getUpdatedContent()\">\n            <option ng-repeat=\"item in aisSortOptions\" value={{::item.id}}>{{::item.name}}</option>\n\n        </select>\n        </div>\n        \n        <div class=\"flex-mobile form-inline\" ng-if=\"data.profileLang == 'en' && !isSearchModeEnabled\">\n          <label class=\"aisearch-mobile-weight\" for=\"sort_picker_select\">${Sort by}</label>\n          <select id=\"sort_picker_select\" class=\"sn-select-basic full-width-drop-down\"\n\t\t\tng-disabled=\"contentItems.length === 0 && data.filterBy ===''\" name=\"sort_picker_select\"\n\t\t\tng-model=\"data.sortBy\" ng-change=\"getUpdatedContent()\">\n      <option ng-repeat=\"item in data.sortOptions\" value={{::item.id}}>{{::item.name}}</option>\n    </select>\n          </div>\n        <div ng-if=\"data.aisEnabledUtahMobile && contentItems.length > 0\" class=\"aiseach-mobile-padding\">\n            <widget id=\"ais_topic_search\" options='data.searchWidgetInitOptions'>\n            </widget>\n          </div>\n      </div>\n    </div>\n\n    <div class=\"box-header-title spellcheck-container\" ng-class=\"{'aiseach-mobile-spellcheck-adjust': data.isMobileApp}\" ng-if=\"isSearchModeEnabled\" aria-live=\"polite\">\n      <div class=\"search-results-container\" ng-if=\"searchedTerm && spellCorrectedTerm && !loading\">\n        <div ng-if=\"spellCorrectedTerm && !data.isMobileApp\">${Showing results for}<button class=\"btn-link\" ng-click=\"handleCorrectedSearch(spellCorrectedTerm, 'spell-corrected-term')\">{{spellCorrectedTerm}}</button>\n        </div>\n        <div ng-if=\"searchedTerm && !data.isMobileApp\">${Search instead for}<button class=\"btn-link\" ng-click=\"handleCorrectedSearch(searchedTerm, 'search-term')\">{{searchedTerm}}</button></div>\n      </div>\n      <div ng-if=\"!data.isMobileApp\" class=\"clear-search-container\">\n        <button class=\"btn btn-link\" ng-click=\"clearSearch()\">{{::data.clearSearchBtn}}</button>\n      </div>\n      <i ng-if=\"data.isMobileApp\" ng-click=\"clearSearch()\" class=\"fa fa-times-circle fa-lg aisearch-reset-blend\" aria-label=\"${Reset Search}\"></i>\n    </div>\n\n    <div aria-live=\"polite\" class=\"sr-only\">\n      <span ng-if=\"isSearchModeEnabled\">\n        <span ng-if=\"loading\">${Loading new items}</span>\n        <span ng-if=\"!loading && noOfNewItems > 0\">{{newItemsAnnouncement}}</span>\n        <span ng-if=\"!loading && noOfNewItems == 0\">${No results match your criteria}</span>\n      </span>\n    </div>\n\n    <ul\n      id=\"{{ data.view == 'list' || data.isMobileApp ? 'tabpanel-list-' + data.sys_id  : 'tabpanel-card-' + data.sys_id }}\"\n      class=\"grid-margin\" ng-class=\"data.view == 'list' || data.isMobileApp ? 'list-view-block': 'grid-test-auto-wrap'\">\n      <li ng-if=\"!loading || data.action ==='show-more' || data.action === 'modify-ais-results'\" class=\"flex-item-card\"\n        ng-class=\"data.view == 'list' ? 'list-view': ''\" ng-repeat=\"item in getContentItems(); track by item.sys_id\"\n        on-finish-repeat=\"ngRepeatFinishedContentCards\">\n        <span ng-if=\"isSearchModeEnabled\" id=\"count_{{item.content}}\" class=\"aria-labelled-by-hidden\">${Item {{$index + 1}} of {{aisContentItems.length}}, }</span>\n        <span ng-if=\"!isSearchModeEnabled\" id=\"count_{{item.content}}\" class=\"aria-labelled-by-hidden\">${Item {{$index + 1}} of {{data.content.length}}, }</span>\n        <div class=\"flex-display\">\n          <sp-widget widget=\"item.widgetData\"></sp-widget>\n        </div>\n      </li>\n      <li ng-if=\"loading\" class=\"flex-item-card skeleton-loading\" ng-class=\"data.view == 'list' ? 'list-view': ''\"\n        ng-repeat=\"item in [1,2,3,4,5,6,7,8,9,10,11,12]\">\n        <span class=\"skeleton-loader badge-loader\"></span>\n        <div class=\"flex-column text-items\">\n          <div class=\"skeleton-loader title-loader\"></div>\n          <div class=\"skeleton-loader description-loader\"></div>\n          <div class=\"skeleton-loader additional-info-loader\"></div>\n          <div class=\"empty\"></div>\n        </div>\n      </li>\n    </ul>\n    <div ng-if=\"!isSearchModeEnabled\">\n      <div class=\"content-align-center\" ng-if=\"data.filterBy !=='' && contentItems.length === 0\">\n        <img src=\"5c50c822c3e930102ec1a589a840dd7b.iix\" />\n        <p ng-bind-html=\"data.noContentMessage\">\n        </p>\n        <p>\n          ${Try another search or remove some filters.}\n        </p>\n      </div>\n      <div class=\"content-align-center\" ng-if=\"(!data.isMobileApp && contentItems.length === 0 && data.filterBy ==='')\">\n        <img src=\"5c50c822c3e930102ec1a589a840dd7b.iix\" />\n        <p>\n          ${No content available}\n        </p>\n      </div>\n      <div class=\"content-align-center\" ng-if=\"(data.isMobileApp && contentItems.length === 0 && data.filterBy ==='')\"\n        ng-bind-html=\"data.mobileNoContentMessage\" />\n      <div ng-if=\"data.showMore\">\n        <button class=\"btn btn-default btn-loadmore\" ng-click=\"loadMore()\" ng-keydown=\"loadMoreKeydown($event)\">\n          {{data.showMoreMsg}}\n        </button>\n      </div>\n    </div>\n\n    <div ng-if=\"isSearchModeEnabled\">\n      <div ng-if=\"data.isMobileApp ? showMoreFlagMobileSearch : hasNext\">\n        <button class=\"btn btn-default btn-loadmore\" ng-click=\"loadMore()\" ng-keydown=\"loadMoreKeydown($event)\">\n          ${Show more}\n        </button>\n      </div>\n      <div ng-if=\"data.showRedirectToGlobal && aisContentItems.length !== 0 && !data.isMobileApp\">\n        <div ng-include=\"'sn-ec-global-search-redirect'\" class=\"content-align-center expand-search-container\"></div>\n\n      </div>\n      <div ng-if=\"aisContentItems.length === 0 && !loading\" class=\"content-align-center search-no-results-container\">\n        <i ng-if=\"!data.isMobileApp\" class=\"fa fa-search\"></i>\n        <img ng-if=\"data.isMobileApp\"\n           ng-src={{c.data.mespEmptyStateImage}}\n           class=\"mesp-image-resize\">\n        <h4 ng-if=\"!data.isMobileApp\">${No results match your criteria.}</h4>\n        <h4 ng-if=\"data.isMobileApp\">${No results match your criteria}</h4>\n        <div ng-if=\"!data.isMobileApp\">\n          <p>${You might find more results with a global search.}</p>\n          <a ng-if=\"data.showRedirectToGlobal\" class=\"btn btn-primary\" role=\"button\" ng-href=\"{{getExpandSearchURL()}}\"\n            aria-labelledby=\"{{data.expandSearchLink}}\" title=\"{{data.expandSearchLink}}\" ng-click=\"setSessionData()\">\n            ${Expand your search}\n            <span class=\"sr-only\" id=\"{{data.expandSearchLink}}-ext-link}\" ng-if=\"(item.target == '_blank')\">${, opens\n              in a new window}\n            </span>\n          </a>\n        </div>\n      \n      </div>\n    </div>\n  </div>\n</div>",
            "max_length": 65000,
            "ed": {
                "name": "template"
            }
        },
        "css": {
            "sys_mandatory": false,
            "visible": true,
            "dbType": -1,
            "label": "CSS",
            "sys_readonly": false,
            "type": "css",
            "mandatory": false,
            "displayValue": "$text-primary : #181A1F !default;\n\n$background-primary : #ffffff !default;\n$background-secondary : #f6f6f8 !default;\n$background-tertiary : #F0F1F5 !default;\n\n$sp-panel-box-shadow : 0 4px 8px 0 rgba(23, 40, 52, 0.08) !default;\n\n$sp-space--sm: 8px !default;\n$sp-space--lg: 16px !default;\n$sp-space--xl : 24px !default;\n$padding-base-vertical: 6px !default;\n\n$border-primary : #8790A1 !default;\n$border-secondary : #ACB2BE !default;\n$border-tertiary : #DADDE2 !default;\n\n$headings-font-weight: 600 !default;\n$divider: #F6F7F7 !default;\n\n$brand-primary: #4f52bd !default;\n\n$brand-focus: $brand-primary-lightest !default;\n\n$border-width-xs : 1px !default;\n\n$input-border-focus: #3c59e7 !default;\n\n/* Double focus ring on cards */\n#tabpanel-card-06d3df67c3053010069aec4b7d40dd70 div:focus {\n  box-shadow: none !important;\n  border: none;\n}\n\nmark {\n  background-color: $brand-focus;\n  color: $text-primary;\n  padding: 0;\n}\n\n.m-r-auto {\n  margin-right: auto;\n}\n\n.p-v-2 {\n  padding: $sp-space--lg 0;\n}\n\n.browse-content-container {\n  .toggle {\n    color: $gray-darker;\n  }\n\n  .fa {\n    border: 4px solid transparent;\n  }\n\n  .view-controls {\n    .pull-right {\n      display: flex;\n      \n      & > .fa-th {\n        border-top-right-radius: 0;\n        border-bottom-right-radius: 0;\n      }\n      \n      & > .fa-list-ul {\n        border-top-left-radius: 0;\n        border-bottom-left-radius: 0;\n      }\n    }\n    .fa {\n      border: $border-width-xs solid $brand-primary;\n      line-height: 18px;\n      padding: $sp-space--sm;\n    }\n    .btn-primary:focus {\n      box-shadow: inset 0 0 0 $border-width-xs $background-primary;\n    }\n    \n    .btn-default:focus {\n      box-shadow: 0 0 5px $input-border-focus;\n    }\n  }\n\n  .filter-padding {\n    padding: 0 $sp-space--lg;\n  }\n\n  .item-fitlers-disable {\n    opacity: 50%;\n    pointer-events: none;\n  }\n\n  .grid-margin {\n    margin-top: $sp-space--xl;\n    padding: 0;\n  }\n\n  .title-item-filters {\n    width: 100%;\n    flex: 1 0 auto;\n    display: flex;\n    align-items: flex-end;\n    justify-content: flex-end;\n    gap: $sp-space--lg;\n\n    select {\n      width: 140px;\n    }\n\n    .filter-search {\n      width: max-content;\n      display: flex;\n      align-items: flex-end;\n      margin-left: $sp-space--lg;\n\n      div[widget=\"widget\"][sn-atf-area=\"AIS Topic Search\"] {\n        padding: 0 $sp-space--lg;\n\n        .input-group {\n          width: 248px;\n        }\n\n        div.dropdown-menu {\n          width: 100%;\n        }\n      }\n    }\n  }\n\n  @media (min-width:62em) and (max-width: 75em) {\n    .title-item-filters {\n      select {\n        width: 120px;\n      }\n    }\n  }\n\n  @media (min-width:38em) and (max-width: 48em) {\n    \n    .browse-elevation-mobile .title-item-filters {\n        justify-content: flex-start !important;\n        width: 100%;\n        flex-direction: column;\n        align-items: initial !important;\n      }\n    \n    .title-item-filters {\n      align-items: initial;\n\n      select {\n        width: 10rem;\n      }\n\n      .filter-padding {\n        padding-right: 0;\n      }\n\n      .filter-search {\n        gap: $sp-space--lg;\n\n        div[widget=\"widget\"][sn-atf-area=\"AIS Topic Search\"] {\n          padding: 0;\n\n          .input-group {\n            width: 20rem;\n          }\n        }\n\n        .view-controls {\n          .toggle {\n            display: flex;\n          }\n        }\n      }\n    }\n  }\n\n  @media (max-width: 38em), (min-width:48em) and (max-width: 64em) {\n    .box-header-title {\n      flex-wrap: wrap;\n\n      &.spellcheck-container {\n        flex-direction: column;\n      }\n    }\n\n    .title-item {\n      width: 100%;\n      margin-bottom: 20px;\n    }\n\n    .title-item-filters {\n      justify-content: flex-start !important;\n      width: 100%;\n      flex-direction: column;\n      align-items: initial !important;\n\n      select {\n        width: 100%;\n        margin-bottom: $sp-space--lg;\n      }\n\n      .filter-search {\n        display: block;\n        padding: 0;\n        margin-left: 0;\n        width: auto;\n\n        div[widget=\"widget\"][sn-atf-area=\"AIS Topic Search\"] {\n          padding: 0;\n\n          .input-group {\n            width: 100%;\n          }\n\n          div.dropdown-menu {\n            width: 100%;\n          }\n        }\n      }\n    }\n\n    .view-controls {\n      display: none;\n    }\n\n    .flex-mobile {\n      width: 100%;\n    }\n\n    .filter-padding {\n      padding: 0;\n    }\n  }\n\n  .box-header-title {\n    display: flex;\n    margin: 0 10px;\n    flex-wrap: wrap;\n\n    .search-results-container {\n      button.btn-link {\n        padding: 0;\n      }\n    }\n\n    .clear-search-container {\n      margin-left: auto;\n\n      button.btn.btn-link {\n        padding: 0;\n      }\n    }\n  }\n\n  .label-padding {\n    padding-right: 5px;\n  }\n\n  .title-item {\n    display: flex;\n    align-items: center;\n    margin-right: 10px;\n    word-break: break-word;\n  }\n\n  .browse-elevation {\n    background: $background-primary;\n    padding: 0.4rem 1.4rem 1rem 1.4rem;\n    border-radius: $border-radius-large;\n    -webkit-box-shadow: $sp-panel-box-shadow;\n    box-shadow: $sp-panel-box-shadow;\n\n    .flex-item-card {\n      border: 1px solid $border-tertiary;\n      border-radius: $border-radius-base;\n      margin: 10px;\n      max-width: 500px;\n      position: relative;\n      display: flex;\n    }\n\n    .flex-item-card:hover {\n      box-shadow: 0rem 0.2rem 1rem #E5E5E5;\n    }\n\n    .flex-display {\n      display: flex;\n      height: 100%;\n      flex-grow: 1;\n\n      >div {\n        flex-grow: 1;\n      }\n    }\n\n    .list-view-block {\n      display: block;\n    }\n\n    .list-view {\n      flex-direction: column;\n      flex-grow: 1;\n      max-width: none;\n\n      .flex-display {\n        flex-direction: column;\n      }\n    }\n\n    .btn-loadmore {\n      margin-left: auto;\n      margin-right: auto;\n      margin-top: 20px;\n      margin-bottom: 20px;\n      display: block;\n      color: $text-primary;\n      background: $background-primary;\n      border-color: $border-tertiary;\n    }\n\n    .btn-loadmore:hover {\n      background: $background-secondary;\n    }\n\n    .btn-loadmore:active {\n      background: $background-tertiary;\n    }\n\n  }\n\n  .browse-elevation-mobile {\n    background: $background-primary;\n    padding: 0 1rem 1rem 1rem;\n    border-bottom: 12px solid $divider;\n    font-size: 14px;\n\n    h3 {\n      font-size: 1.25rem !important;\n      font-weight: bold;\n    }\n\n    .flex-item-card {\n      display: flex;\n      flex-direction: column;\n      align-items: stretch;\n      border-bottom: 1px solid #EAEAEA;\n      position: relative;\n    }\n\n    .flex-display {\n      display: flex;\n      flex-direction: column;\n      align-items: stretch;\n    }\n\n    .box-header-title {\n      margin: 0;\n    }\n\t\n    .btn-loadmore {\n      width: 90%;\n      margin-left: auto;\n      margin-right: auto;\n      margin-top: 20px;\n      display: block;\n    }\n\n    .filter-padding {\n      padding-left: 0;\n    }\n\n    .label-padding {\n      font-weight: $headings-font-weight;\n    }\n\n    .full-width-drop-down {\n      width: 100%;\n      border: 1px solid $border;\n      border-radius: 4px;\n      font-weight: $headings-font-weight;\n    }\n\n    .select2-container {\n\n      /* need to over ride the important style of mesp which already has important for a11y reasons*/\n      #s2id_autogen1,\n      #s2id_autogen2 {\n        width: 100% !important;\n        height: 100% !important;\n      }\n\n      .select2-choice {\n        /* Tappable areas on mobile should be atleast 48px in height*/\n        min-height: 48px;\n\n        span[role=\"text\"].select2-chosen {\n          padding-top: 1rem;\n          padding-bottom: 1rem;\n        }\n      }\n    }\n    .select2-container {\n      .select2-choice {\n        span.select2-chosen {\n          padding-top: 1rem;\n          padding-bottom: 1rem;\n        }\n      }\n    }\n\n    .select2-reference .select2-arrow,\n    .select2-choice .select2-arrow {\n      /* need to over ride the important style of mesp which already has important */\n      right: 0.5rem !important;\n      padding-top: 8px;\n    }\n\n    .select2-container .select2-choice .select2-arrow b:before {\n      content: \"\\f107\";\n      font-family: FontAwesome;\n    }\n\n    .select2-container .select2-choice {\n      padding-bottom: 0;\n      /* need to over ride the important style of mesp which already has important */\n      box-shadow: none !important;\n    }\n\n    .select2-container .select2-choice .select2-chosen {\n      font-size: 14px;\n    }\n\n    .grid-test-auto-wrap {\n      grid-template-columns: repeat(auto-fit, minmax(16.25rem, 1fr));\n    }\n\n    .content-align-center {\n      min-height: 200px;\n    }\n\n    .item-fitlers-disable {\n      display: none;\n    }\n  }\n\n  .content-align-center {\n    display: flex;\n    flex-direction: column;\n    justify-content: center;\n    align-items: center;\n    min-height: 300px;\n    text-align: center;\n\n    &.expand-search-container {\n      min-height: 134px;\n      background-color: $background-tertiary;\n      margin: $sp-space--xl 10px $sp-space--sm 10px;\n      padding: $padding-base-horizontal;\n      border-radius: $border-radius-large;\n\n      .expand-search-message {\n        color: $text-secondary;\n        margin-bottom: $sp-space--sm;\n      }\n\n      a {\n        color: $link-color;\n      }\n    }\n    \n    .no-content-msg{\n      \tall: inherit;\n    }\n  }\n\n  .grid-test-auto-wrap {\n    display: grid;\n    grid-template-columns: repeat(auto-fill, minmax(26rem, 1fr));\n  }\n\n  .search-no-results-container {\n    margin: $sp-space--xl;\n    padding: $sp-space--lg;\n\n    i.fa.fa-search {\n      font-size: 2 * $font-size-xl;\n      color: $text-tertiary;\n      margin-bottom: $sp-space--md;\n    }\n\n    p {\n      color: $text-secondary;\n      font-size: $font-size-base;\n      margin-bottom: $sp-space--md;\n    }\n  }\n}\n\n.skeleton-loading {\n  padding: 10px;\n  $loader-line-height: 15px;\n\n  .text-items {\n    width: 100%;\n  }\n\n  .title-loader {\n    height: $loader-line-height;\n    width: 95%\n  }\n\n  .description-loader {\n    height: $loader-line-height;\n    width: 70%\n  }\n\n  .additional-info-loader {\n    height: $loader-line-height;\n    width: 40%\n  }\n\n  .badge-loader {\n    height: 25px;\n    width: 50%\n  }\n\n  .empty {\n    height: 30px;\n  }\n\n  .skeleton-loader {\n    box-sizing: border-box;\n    animation: progress 2s ease-in-out infinite;\n    background: rgb(239, 241, 246) no-repeat;\n    background-image: linear-gradient(90deg, rgba(255, 255, 255, 0), rgba(255, 255, 255, 0.6), rgba(255, 255, 255, 0));\n    background-size: 200px 100%;\n    border-radius: 5px;\n    display: inline-block;\n    margin-bottom: 6px;\n\n    &:after,\n    &:before {\n      box-sizing: border-box;\n    }\n  }\n}\n@media (max-width : 350px) {\n  .browse-content-container {\n    .grid-test-auto-wrap {\n      grid-template-columns: repeat(auto-fill, minmax(22rem, 1fr));\n    }\n  }\n}\n\n@keyframes progress {\n  0% {\n    background-position: -200px 0;\n  }\n\n  100% {\n    background-position: calc(200px + 100%) 0;\n  }\n}\n\n.aiseach-mobile-padding {\n    padding-top:7%;\n    padding-left:0%;\n    padding-right:0%;\n    padding-bottom: 23px;\n}\n\n.aiseach-mobile-spellcheck-adjust {\n    padding-top: 25px;\n}\n\n.aiseach-mobile-textAlign {\n    font-weight: 400;\n}\n\n.aisearch-mobile-weight {\n    font-weight: 600;\n}\n\n.aiseach-mobile-height {\n    height: 51px;\n}\n\n.aisearch-reset-blend {\n    position: relative;\n    float: right;\n    top: -47px;\n    width: 15px;\n    left: 90%;\n    right: 10.65%;\n    z-index: 1000;\n}\n\n.aria-labelled-by-hidden {\n    display: none;\n}\n\n@media (orientation: landscape) {\n  .aisearch-reset-blend {\n    left: 94%;\n  }\n  \n  .aiseach-mobile-padding {\n    padding-top: 5%; \n  }\n}\n\n.mesp-image-resize {\n\theight: auto;\n  \twidth: 90%;\n  \tpadding-bottom: 20px;\n}\n\n@media only screen and (min-device-width: 768px) and (max-device-width: 1024px) {\n  .browse-elevation-mobile .title-item-filters {\n    justify-content: flex-start !important;&#13;\n    width: 100%;&#13;\n    flex-direction: column;&#13;\n    align-items: initial !important;&#13;\n  }\n  \n  .aiseach-mobile-padding {\n    padding-top: 3%; \n  }\n  \n  .aisearch-reset-blend {\n    left: 96%;\n  }\n}\n\n@media only screen and (min-device-width: 768px) and (max-device-width: 1024px) and (orientation:landscape) {\n  .aisearch-reset-blend {\n    left: 96.5%;\n  }\n}",
            "readonly": false,
            "hint": "",
            "name": "css",
            "attributes": {},
            "choice": 0,
            "value": "$text-primary : #181A1F !default;\n\n$background-primary : #ffffff !default;\n$background-secondary : #f6f6f8 !default;\n$background-tertiary : #F0F1F5 !default;\n\n$sp-panel-box-shadow : 0 4px 8px 0 rgba(23, 40, 52, 0.08) !default;\n\n$sp-space--sm: 8px !default;\n$sp-space--lg: 16px !default;\n$sp-space--xl : 24px !default;\n$padding-base-vertical: 6px !default;\n\n$border-primary : #8790A1 !default;\n$border-secondary : #ACB2BE !default;\n$border-tertiary : #DADDE2 !default;\n\n$headings-font-weight: 600 !default;\n$divider: #F6F7F7 !default;\n\n$brand-primary: #4f52bd !default;\n\n$brand-focus: $brand-primary-lightest !default;\n\n$border-width-xs : 1px !default;\n\n$input-border-focus: #3c59e7 !default;\n\n/* Double focus ring on cards */\n#tabpanel-card-06d3df67c3053010069aec4b7d40dd70 div:focus {\n  box-shadow: none !important;\n  border: none;\n}\n\nmark {\n  background-color: $brand-focus;\n  color: $text-primary;\n  padding: 0;\n}\n\n.m-r-auto {\n  margin-right: auto;\n}\n\n.p-v-2 {\n  padding: $sp-space--lg 0;\n}\n\n.browse-content-container {\n  .toggle {\n    color: $gray-darker;\n  }\n\n  .fa {\n    border: 4px solid transparent;\n  }\n\n  .view-controls {\n    .pull-right {\n      display: flex;\n      \n      & > .fa-th {\n        border-top-right-radius: 0;\n        border-bottom-right-radius: 0;\n      }\n      \n      & > .fa-list-ul {\n        border-top-left-radius: 0;\n        border-bottom-left-radius: 0;\n      }\n    }\n    .fa {\n      border: $border-width-xs solid $brand-primary;\n      line-height: 18px;\n      padding: $sp-space--sm;\n    }\n    .btn-primary:focus {\n      box-shadow: inset 0 0 0 $border-width-xs $background-primary;\n    }\n    \n    .btn-default:focus {\n      box-shadow: 0 0 5px $input-border-focus;\n    }\n  }\n\n  .filter-padding {\n    padding: 0 $sp-space--lg;\n  }\n\n  .item-fitlers-disable {\n    opacity: 50%;\n    pointer-events: none;\n  }\n\n  .grid-margin {\n    margin-top: $sp-space--xl;\n    padding: 0;\n  }\n\n  .title-item-filters {\n    width: 100%;\n    flex: 1 0 auto;\n    display: flex;\n    align-items: flex-end;\n    justify-content: flex-end;\n    gap: $sp-space--lg;\n\n    select {\n      width: 140px;\n    }\n\n    .filter-search {\n      width: max-content;\n      display: flex;\n      align-items: flex-end;\n      margin-left: $sp-space--lg;\n\n      div[widget=\"widget\"][sn-atf-area=\"AIS Topic Search\"] {\n        padding: 0 $sp-space--lg;\n\n        .input-group {\n          width: 248px;\n        }\n\n        div.dropdown-menu {\n          width: 100%;\n        }\n      }\n    }\n  }\n\n  @media (min-width:62em) and (max-width: 75em) {\n    .title-item-filters {\n      select {\n        width: 120px;\n      }\n    }\n  }\n\n  @media (min-width:38em) and (max-width: 48em) {\n    \n    .browse-elevation-mobile .title-item-filters {\n        justify-content: flex-start !important;\n        width: 100%;\n        flex-direction: column;\n        align-items: initial !important;\n      }\n    \n    .title-item-filters {\n      align-items: initial;\n\n      select {\n        width: 10rem;\n      }\n\n      .filter-padding {\n        padding-right: 0;\n      }\n\n      .filter-search {\n        gap: $sp-space--lg;\n\n        div[widget=\"widget\"][sn-atf-area=\"AIS Topic Search\"] {\n          padding: 0;\n\n          .input-group {\n            width: 20rem;\n          }\n        }\n\n        .view-controls {\n          .toggle {\n            display: flex;\n          }\n        }\n      }\n    }\n  }\n\n  @media (max-width: 38em), (min-width:48em) and (max-width: 64em) {\n    .box-header-title {\n      flex-wrap: wrap;\n\n      &.spellcheck-container {\n        flex-direction: column;\n      }\n    }\n\n    .title-item {\n      width: 100%;\n      margin-bottom: 20px;\n    }\n\n    .title-item-filters {\n      justify-content: flex-start !important;\n      width: 100%;\n      flex-direction: column;\n      align-items: initial !important;\n\n      select {\n        width: 100%;\n        margin-bottom: $sp-space--lg;\n      }\n\n      .filter-search {\n        display: block;\n        padding: 0;\n        margin-left: 0;\n        width: auto;\n\n        div[widget=\"widget\"][sn-atf-area=\"AIS Topic Search\"] {\n          padding: 0;\n\n          .input-group {\n            width: 100%;\n          }\n\n          div.dropdown-menu {\n            width: 100%;\n          }\n        }\n      }\n    }\n\n    .view-controls {\n      display: none;\n    }\n\n    .flex-mobile {\n      width: 100%;\n    }\n\n    .filter-padding {\n      padding: 0;\n    }\n  }\n\n  .box-header-title {\n    display: flex;\n    margin: 0 10px;\n    flex-wrap: wrap;\n\n    .search-results-container {\n      button.btn-link {\n        padding: 0;\n      }\n    }\n\n    .clear-search-container {\n      margin-left: auto;\n\n      button.btn.btn-link {\n        padding: 0;\n      }\n    }\n  }\n\n  .label-padding {\n    padding-right: 5px;\n  }\n\n  .title-item {\n    display: flex;\n    align-items: center;\n    margin-right: 10px;\n    word-break: break-word;\n  }\n\n  .browse-elevation {\n    background: $background-primary;\n    padding: 0.4rem 1.4rem 1rem 1.4rem;\n    border-radius: $border-radius-large;\n    -webkit-box-shadow: $sp-panel-box-shadow;\n    box-shadow: $sp-panel-box-shadow;\n\n    .flex-item-card {\n      border: 1px solid $border-tertiary;\n      border-radius: $border-radius-base;\n      margin: 10px;\n      max-width: 500px;\n      position: relative;\n      display: flex;\n    }\n\n    .flex-item-card:hover {\n      box-shadow: 0rem 0.2rem 1rem #E5E5E5;\n    }\n\n    .flex-display {\n      display: flex;\n      height: 100%;\n      flex-grow: 1;\n\n      >div {\n        flex-grow: 1;\n      }\n    }\n\n    .list-view-block {\n      display: block;\n    }\n\n    .list-view {\n      flex-direction: column;\n      flex-grow: 1;\n      max-width: none;\n\n      .flex-display {\n        flex-direction: column;\n      }\n    }\n\n    .btn-loadmore {\n      margin-left: auto;\n      margin-right: auto;\n      margin-top: 20px;\n      margin-bottom: 20px;\n      display: block;\n      color: $text-primary;\n      background: $background-primary;\n      border-color: $border-tertiary;\n    }\n\n    .btn-loadmore:hover {\n      background: $background-secondary;\n    }\n\n    .btn-loadmore:active {\n      background: $background-tertiary;\n    }\n\n  }\n\n  .browse-elevation-mobile {\n    background: $background-primary;\n    padding: 0 1rem 1rem 1rem;\n    border-bottom: 12px solid $divider;\n    font-size: 14px;\n\n    h3 {\n      font-size: 1.25rem !important;\n      font-weight: bold;\n    }\n\n    .flex-item-card {\n      display: flex;\n      flex-direction: column;\n      align-items: stretch;\n      border-bottom: 1px solid #EAEAEA;\n      position: relative;\n    }\n\n    .flex-display {\n      display: flex;\n      flex-direction: column;\n      align-items: stretch;\n    }\n\n    .box-header-title {\n      margin: 0;\n    }\n\t\n    .btn-loadmore {\n      width: 90%;\n      margin-left: auto;\n      margin-right: auto;\n      margin-top: 20px;\n      display: block;\n    }\n\n    .filter-padding {\n      padding-left: 0;\n    }\n\n    .label-padding {\n      font-weight: $headings-font-weight;\n    }\n\n    .full-width-drop-down {\n      width: 100%;\n      border: 1px solid $border;\n      border-radius: 4px;\n      font-weight: $headings-font-weight;\n    }\n\n    .select2-container {\n\n      /* need to over ride the important style of mesp which already has important for a11y reasons*/\n      #s2id_autogen1,\n      #s2id_autogen2 {\n        width: 100% !important;\n        height: 100% !important;\n      }\n\n      .select2-choice {\n        /* Tappable areas on mobile should be atleast 48px in height*/\n        min-height: 48px;\n\n        span[role=\"text\"].select2-chosen {\n          padding-top: 1rem;\n          padding-bottom: 1rem;\n        }\n      }\n    }\n    .select2-container {\n      .select2-choice {\n        span.select2-chosen {\n          padding-top: 1rem;\n          padding-bottom: 1rem;\n        }\n      }\n    }\n\n    .select2-reference .select2-arrow,\n    .select2-choice .select2-arrow {\n      /* need to over ride the important style of mesp which already has important */\n      right: 0.5rem !important;\n      padding-top: 8px;\n    }\n\n    .select2-container .select2-choice .select2-arrow b:before {\n      content: \"\\f107\";\n      font-family: FontAwesome;\n    }\n\n    .select2-container .select2-choice {\n      padding-bottom: 0;\n      /* need to over ride the important style of mesp which already has important */\n      box-shadow: none !important;\n    }\n\n    .select2-container .select2-choice .select2-chosen {\n      font-size: 14px;\n    }\n\n    .grid-test-auto-wrap {\n      grid-template-columns: repeat(auto-fit, minmax(16.25rem, 1fr));\n    }\n\n    .content-align-center {\n      min-height: 200px;\n    }\n\n    .item-fitlers-disable {\n      display: none;\n    }\n  }\n\n  .content-align-center {\n    display: flex;\n    flex-direction: column;\n    justify-content: center;\n    align-items: center;\n    min-height: 300px;\n    text-align: center;\n\n    &.expand-search-container {\n      min-height: 134px;\n      background-color: $background-tertiary;\n      margin: $sp-space--xl 10px $sp-space--sm 10px;\n      padding: $padding-base-horizontal;\n      border-radius: $border-radius-large;\n\n      .expand-search-message {\n        color: $text-secondary;\n        margin-bottom: $sp-space--sm;\n      }\n\n      a {\n        color: $link-color;\n      }\n    }\n    \n    .no-content-msg{\n      \tall: inherit;\n    }\n  }\n\n  .grid-test-auto-wrap {\n    display: grid;\n    grid-template-columns: repeat(auto-fill, minmax(26rem, 1fr));\n  }\n\n  .search-no-results-container {\n    margin: $sp-space--xl;\n    padding: $sp-space--lg;\n\n    i.fa.fa-search {\n      font-size: 2 * $font-size-xl;\n      color: $text-tertiary;\n      margin-bottom: $sp-space--md;\n    }\n\n    p {\n      color: $text-secondary;\n      font-size: $font-size-base;\n      margin-bottom: $sp-space--md;\n    }\n  }\n}\n\n.skeleton-loading {\n  padding: 10px;\n  $loader-line-height: 15px;\n\n  .text-items {\n    width: 100%;\n  }\n\n  .title-loader {\n    height: $loader-line-height;\n    width: 95%\n  }\n\n  .description-loader {\n    height: $loader-line-height;\n    width: 70%\n  }\n\n  .additional-info-loader {\n    height: $loader-line-height;\n    width: 40%\n  }\n\n  .badge-loader {\n    height: 25px;\n    width: 50%\n  }\n\n  .empty {\n    height: 30px;\n  }\n\n  .skeleton-loader {\n    box-sizing: border-box;\n    animation: progress 2s ease-in-out infinite;\n    background: rgb(239, 241, 246) no-repeat;\n    background-image: linear-gradient(90deg, rgba(255, 255, 255, 0), rgba(255, 255, 255, 0.6), rgba(255, 255, 255, 0));\n    background-size: 200px 100%;\n    border-radius: 5px;\n    display: inline-block;\n    margin-bottom: 6px;\n\n    &:after,\n    &:before {\n      box-sizing: border-box;\n    }\n  }\n}\n@media (max-width : 350px) {\n  .browse-content-container {\n    .grid-test-auto-wrap {\n      grid-template-columns: repeat(auto-fill, minmax(22rem, 1fr));\n    }\n  }\n}\n\n@keyframes progress {\n  0% {\n    background-position: -200px 0;\n  }\n\n  100% {\n    background-position: calc(200px + 100%) 0;\n  }\n}\n\n.aiseach-mobile-padding {\n    padding-top:7%;\n    padding-left:0%;\n    padding-right:0%;\n    padding-bottom: 23px;\n}\n\n.aiseach-mobile-spellcheck-adjust {\n    padding-top: 25px;\n}\n\n.aiseach-mobile-textAlign {\n    font-weight: 400;\n}\n\n.aisearch-mobile-weight {\n    font-weight: 600;\n}\n\n.aiseach-mobile-height {\n    height: 51px;\n}\n\n.aisearch-reset-blend {\n    position: relative;\n    float: right;\n    top: -47px;\n    width: 15px;\n    left: 90%;\n    right: 10.65%;\n    z-index: 1000;\n}\n\n.aria-labelled-by-hidden {\n    display: none;\n}\n\n@media (orientation: landscape) {\n  .aisearch-reset-blend {\n    left: 94%;\n  }\n  \n  .aiseach-mobile-padding {\n    padding-top: 5%; \n  }\n}\n\n.mesp-image-resize {\n\theight: auto;\n  \twidth: 90%;\n  \tpadding-bottom: 20px;\n}\n\n@media only screen and (min-device-width: 768px) and (max-device-width: 1024px) {\n  .browse-elevation-mobile .title-item-filters {\n    justify-content: flex-start !important;&#13;\n    width: 100%;&#13;\n    flex-direction: column;&#13;\n    align-items: initial !important;&#13;\n  }\n  \n  .aiseach-mobile-padding {\n    padding-top: 3%; \n  }\n  \n  .aisearch-reset-blend {\n    left: 96%;\n  }\n}\n\n@media only screen and (min-device-width: 768px) and (max-device-width: 1024px) and (orientation:landscape) {\n  .aisearch-reset-blend {\n    left: 96.5%;\n  }\n}",
            "max_length": 8000,
            "ed": {
                "name": "css"
            }
        },
        "roles": {
            "sys_mandatory": false,
            "visible": true,
            "dbType": 12,
            "label": "Roles",
            "sys_readonly": false,
            "type": "user_roles",
            "mandatory": false,
            "displayValue": "",
            "readonly": false,
            "hint": "",
            "name": "roles",
            "attributes": {
                "no_truncate": "true",
                "update_exempt": "true",
                "record_watcher_blacklist": "true"
            },
            "choice": 0,
            "value": "",
            "max_length": 255,
            "ed": {
                "name": "roles"
            }
        },
        "link": {
            "sys_mandatory": false,
            "visible": true,
            "dbType": -1,
            "label": "Link",
            "sys_readonly": false,
            "type": "script",
            "mandatory": false,
            "displayValue": "function link(scope, element, attrs, controller) {\n      if(controller.data.isMobileApp){\n      var destroyWatcher = scope.$watch(\n      function () { return element.find('.select2-choice span.select2-chosen').length; },\n      function (newValue, oldValue) {\n        if (newValue !== oldValue) {\n          var mespSelectInputs = element.find('.select2-choice span.select2-chosen');\n          if(mespSelectInputs.length == 2){\n            mespSelectInputs[0].setAttribute('role', 'text');\n            mespSelectInputs[1].setAttribute('role', 'text');\n            destroyWatcher();\n          }\n        }\n      }\n    );\n  }\n}",
            "readonly": false,
            "hint": "",
            "name": "link",
            "attributes": {
                "client_script": "true"
            },
            "choice": 0,
            "value": "function link(scope, element, attrs, controller) {\n      if(controller.data.isMobileApp){\n      var destroyWatcher = scope.$watch(\n      function () { return element.find('.select2-choice span.select2-chosen').length; },\n      function (newValue, oldValue) {\n        if (newValue !== oldValue) {\n          var mespSelectInputs = element.find('.select2-choice span.select2-chosen');\n          if(mespSelectInputs.length == 2){\n            mespSelectInputs[0].setAttribute('role', 'text');\n            mespSelectInputs[1].setAttribute('role', 'text');\n            destroyWatcher();\n          }\n        }\n      }\n    );\n  }\n}",
            "max_length": 65000,
            "ed": {
                "name": "link"
            }
        },
        "description": {
            "sys_mandatory": false,
            "visible": true,
            "dbType": -1,
            "label": "Description",
            "sys_readonly": false,
            "type": "string",
            "mandatory": false,
            "displayValue": "",
            "readonly": false,
            "hint": "Defines what the widget does",
            "name": "description",
            "attributes": {
                "edge_encryption_enabled": "true"
            },
            "choice": 0,
            "value": "",
            "max_length": 300,
            "ed": {
                "name": "description"
            }
        },
        "demo_data": {
            "sys_mandatory": false,
            "visible": true,
            "dbType": -1,
            "label": "Demo data",
            "sys_readonly": false,
            "type": "json",
            "mandatory": false,
            "displayValue": "",
            "readonly": false,
            "hint": "",
            "name": "demo_data",
            "attributes": {},
            "choice": 0,
            "value": "",
            "max_length": 8000,
            "ed": {
                "name": "demo_data"
            }
        },
        "option_schema": {
            "sys_mandatory": false,
            "visible": true,
            "dbType": -1,
            "label": "Option schema",
            "sys_readonly": false,
            "type": "json",
            "mandatory": false,
            "displayValue": "[{\"hint\":\"Pagination for browse content.\",\"name\":\"limit\",\"section\":\"Presentation\",\"default_value\":\"12\",\"label\":\"Number of items per page\",\"type\":\"choice\",\"choices\":[{\"label\":\"12\",\"value\":\"12\"},{\"label\":\"24\",\"value\":\"24\"}]},{\"hint\":\"Default sort order of content\",\"name\":\"sortby\",\"section\":\"Behavior\",\"default_value\":\"popularity\",\"label\":\"Default sort order\",\"type\":\"choice\",\"choices\":[{\"label\":\"popularity\",\"value\":\"popularity\"},{\"label\":\"alphabetical\",\"value\":\"alphabetical\"}]},{\"displayValue\":\"Search Application Configuration\",\"hint\":\"Default search application sys id\",\"name\":\"search_application\",\"section\":\"Data\",\"default_value\":\"7296910f53171010069addeeff7b12e7\",\"label\":\"Search Application\",\"type\":\"reference\",\"value\":\"sys_search_context_config\",\"ed\":{\"reference\":\"sys_search_context_config\"}},{\"displayValue\":\"Navigation Tab\",\"hint\":\"Comma separated list of SYS IDs for searched sources filter from sys_search_filter table\",\"name\":\"search_sources_filter\",\"display_value_list\":[],\"section\":\"Data\",\"default_value\":\"aed3c51253671010069addeeff7b121b,a6d3c51253671010069addeeff7b1217,62d1574053c13010cbb0ddeeff7b122c\",\"label\":\"Search Sources Filter\",\"type\":\"glide_list\",\"value\":\"sys_search_filter\",\"ed\":{\"reference\":\"sys_search_filter\"}},{\"displayValue\":\"Give employees the option to globally expand their search\",\"hint\":\"Give employees the option to globally expand their search\",\"name\":\"show_global_redirect\",\"section\":\"Behavior\",\"default_value\":\"true\",\"label\":\"Give employees the option to globally expand their search\",\"type\":\"boolean\"},{\"name\":\"content_displayed_from\",\"section\":\"Behavior\",\"default_value\":\"Current topic and all child topics\",\"label\":\"Content displayed from\",\"type\":\"choice\",\"choices\":[{\"label\":\"Current topic only\",\"value\":\"Current topic only\"},{\"label\":\"Current topic and all child topics\",\"value\":\"Current topic and all child topics\"}]},{\"hint\":\"Title name of the widget\",\"name\":\"title\",\"section\":\"Presentation\",\"default_value\":\"Support resources\",\"label\":\"Title\",\"type\":\"string\"},{\"hint\":\"Shows empty state if the widget content is empty.\",\"name\":\"show_empty_state\",\"section\":\"Other Options\",\"default_value\":\"true\",\"label\":\"Show empty state\",\"type\":\"boolean\"}]",
            "readonly": false,
            "hint": "",
            "name": "option_schema",
            "attributes": {},
            "choice": 0,
            "value": "[{\"hint\":\"Pagination for browse content.\",\"name\":\"limit\",\"section\":\"Presentation\",\"default_value\":\"12\",\"label\":\"Number of items per page\",\"type\":\"choice\",\"choices\":[{\"label\":\"12\",\"value\":\"12\"},{\"label\":\"24\",\"value\":\"24\"}]},{\"hint\":\"Default sort order of content\",\"name\":\"sortby\",\"section\":\"Behavior\",\"default_value\":\"popularity\",\"label\":\"Default sort order\",\"type\":\"choice\",\"choices\":[{\"label\":\"popularity\",\"value\":\"popularity\"},{\"label\":\"alphabetical\",\"value\":\"alphabetical\"}]},{\"displayValue\":\"Search Application Configuration\",\"hint\":\"Default search application sys id\",\"name\":\"search_application\",\"section\":\"Data\",\"default_value\":\"7296910f53171010069addeeff7b12e7\",\"label\":\"Search Application\",\"type\":\"reference\",\"value\":\"sys_search_context_config\",\"ed\":{\"reference\":\"sys_search_context_config\"}},{\"displayValue\":\"Navigation Tab\",\"hint\":\"Comma separated list of SYS IDs for searched sources filter from sys_search_filter table\",\"name\":\"search_sources_filter\",\"display_value_list\":[],\"section\":\"Data\",\"default_value\":\"aed3c51253671010069addeeff7b121b,a6d3c51253671010069addeeff7b1217,62d1574053c13010cbb0ddeeff7b122c\",\"label\":\"Search Sources Filter\",\"type\":\"glide_list\",\"value\":\"sys_search_filter\",\"ed\":{\"reference\":\"sys_search_filter\"}},{\"displayValue\":\"Give employees the option to globally expand their search\",\"hint\":\"Give employees the option to globally expand their search\",\"name\":\"show_global_redirect\",\"section\":\"Behavior\",\"default_value\":\"true\",\"label\":\"Give employees the option to globally expand their search\",\"type\":\"boolean\"},{\"name\":\"content_displayed_from\",\"section\":\"Behavior\",\"default_value\":\"Current topic and all child topics\",\"label\":\"Content displayed from\",\"type\":\"choice\",\"choices\":[{\"label\":\"Current topic only\",\"value\":\"Current topic only\"},{\"label\":\"Current topic and all child topics\",\"value\":\"Current topic and all child topics\"}]},{\"hint\":\"Title name of the widget\",\"name\":\"title\",\"section\":\"Presentation\",\"default_value\":\"Support resources\",\"label\":\"Title\",\"type\":\"string\"},{\"hint\":\"Shows empty state if the widget content is empty.\",\"name\":\"show_empty_state\",\"section\":\"Other Options\",\"default_value\":\"true\",\"label\":\"Show empty state\",\"type\":\"boolean\"}]",
            "max_length": 8000,
            "ed": {
                "name": "option_schema"
            }
        },
        "script": {
            "sys_mandatory": false,
            "visible": true,
            "dbType": -1,
            "label": "Server script",
            "sys_readonly": false,
            "type": "script",
            "mandatory": false,
            "displayValue": "(function() {\n    var portalRecord = $sp.getPortalRecord();\n    data.widgetInstance = $sp.getValue('sys_id');\n    data.showEmptyState = options.show_empty_state ? options.show_empty_state : 'true';\n    data.EVENTS = new sn_ex_sp.ContentSearchUtils().getInstanceEvents(data.widgetInstance);\n    data.aisEnabledUtah = gs.getProperty('taxonomy.aisearch.enabled.utah') == 'true' && $sp.isAISearchEnabled();\n    var ais = new sn_ais.StatusApi();\n    data.aisEnabledUtahMobile = gs.getProperty('taxonomy.aisearch.enabled.utah') == 'true' && ais.isAisEnabled() && ais.isAisInitialized();\n    data.mespEmptyStateImage = new sn_ex_sp.TopicPageUtil().getDBImage(\"sn_ex_sp.MESP_empty_state_image_used.png\");\n    data.profileLang = gs.getSession().getLanguage();\n    data.sys_id = $sp.getParameter('topic_id');\n    data.in_context = $sp.getParameter('in_context');\n    data.sys_id = gs.nil(data.sys_id) ? '-1' : data.sys_id;\n    data.limit = parseInt(options.limit) || 12;\n    data.widgetTitle = options && options.title ? gs.getMessage(options.title) : gs.getMessage(\"Support resources\");\n    // change this to use native mobile script to identify is mobile.\n    data.isMobile = gs.isMobile();\n    data.isMobileApp = $sp.getParameter('view') === 'mobile';\n    if (data.isMobileApp) {\n        data.limit = 5;\n    }\n    data.isLearningUpdated = GlidePluginManager.isActive('sn_lc');\n    data.contentTableToWidget = {\n        'sc_cat_item': 'catalog-content',\n        'kb_knowledge': 'kb-content'\n    };\n    if (data.isLearningUpdated) {\n        data.contentTableToWidget.sn_lc_course_item = 'learning-content';\n    }\n\n    //Employee Browser Extensioon Integration \t\n    data.isECBEInstalled = GlidePluginManager.isActive('com.snc.ex_browser_extension');\n    data.isECBEPortal = false;\n    var ecbeUtils;\n    if (data.isECBEInstalled) {\n        ecbeUtils = new sn_ex_brw_ext.ECBEUtil();\n        data.isECBEPortal = ecbeUtils.isECBEPortal($sp);\n\tif (data.isECBEPortal) {\n\t\tvar currentWebsiteObject = ecbeUtils.fetchWebsiteFromSession(); \n\t\tdata.currentWebsite = gs.nil(currentWebsiteObject.website)? null:currentWebsiteObject.website;\n\t}\t\t\n    }\n\n    var sortOptions = [{\n        id: \"popularity\",\n        name: gs.getMessage(\"Popular\", \"Popular\")\n    }, {\n        id: \"alphabetical\",\n        name: gs.getMessage(\"A-Z\", \"A-Z\")\n    }];\n    var actions = {\n        showMore: \"show-more\",\n        filter: \"filter\",\n        sort: \"sort\",\n        storeView: \"storeView\",\n        modifyAISResults: \"modify-ais-results\"\n    };\n    var REQUESTS = sn_i18n.Message.getMessage(\"sn_ex_sp\", \"Requests\");\n    var ARTICLES = gs.getMessage(\"Articles\");\n    var COURSES = gs.getMessage(\"Courses\");\n    data.showRedirectToGlobal = options.show_global_redirect === 'true';\n\n    // AIS content search integration\n    data.clearSearchBtn = gs.getMessage(\"Reset search\");\n    data.btnTitle = gs.getMessage(\"Search button\");\n    data.placeholder = gs.getMessage(\"Search resources\");\n    data.expandSearchMsg = gs.getMessage(\"Didn't find what you're looking for?\");\n    data.expandSearchLink = gs.getMessage(\"Expand your search\");\n    data.searchAppConfigId = portalRecord.getValue('search_application');\n\n    try {\n        var search_app_sys_id = options.search_application || data.searchAppConfigId;\n        var filters = \"\";\n        data.ui = {\n            aisFacetFilters: [],\n            aisSearchFilters: [],\n            aisSortOptions: []\n        };\n        var searchConfig = new sn_ex_sp.TopicPageUtil().getSearchConfiguration(portalRecord.getUniqueValue(), data.widgetInstance);\n        if (searchConfig) {\n            search_app_sys_id = searchConfig.searchApplication;\n            data.search_sources_filter = searchConfig.searchFilters;\n            filters = searchConfig.searchFilters;\n            getSearchConfigParams(search_app_sys_id, filters);\n        } else {\n            getSearchConfigParams(search_app_sys_id);\n            var defaultSearchFilters = options.search_sources_filter || '';\n            data.search_sources_filter = defaultSearchFilters.split(',');\n            filters = defaultSearchFilters ? defaultSearchFilters.split(',') : data.ui.aisSearchFilters.map(function(f) {\n                return f.sysId;\n            });\n        }\n        data.searchWidgetInitOptions = {\n            'facet': JSON.stringify(data.ui.aisFacetFilters).replaceAll('\\\\\"', '\\\\\\\\\\\\\\\\\"').replaceAll('\"', '\\\\\\\\\\\\\"'),\n            'filter': JSON.stringify(filters).replaceAll('\"', '\\\\\\\\\\\\\"'),\n            'sort': JSON.stringify([]).replaceAll('\"', '\\\\\\\\\\\\\"'),\n            'searchConfigId': search_app_sys_id,\n            'btnTitle': data.btnTitle,\n            'placeholder': data.placeholder,\n            'parentWidgetInstance': data.widgetInstance,\n            'isMobileApp': data.isMobileApp\n        };\n\n        if (data.isMobileApp) {\n            data.searchWidgetInitOptions.disableSpellCheck = true;\n        }\n\n        //if user does a search\n        if (input && input.action === actions.modifyAISResults) {\n            data.modifiedAISResponse = input.aisSearchResults.map(function(item) {\n                item = postProcessAISResponse(item);\n                return item;\n            });\n            addContentWidget(data.modifiedAISResponse);\n            // initializing preferences object\n            var preferences = JSON.stringify({\n                filter: input.filterBy || '',\n                sort: input.sortBy || data.sortBy,\n                view: input.view || data.view,\n                topic: data.sys_id,\n                userId: gs.getUserID()\n            });\n            var preferencesObj = gs.getSession().getClientData(\"preferences\");\n            if (!preferencesObj) {\n                gs.getSession().putClientData('preferences', preferences);\n            }\n            return;\n        }\n    } catch (err) {\n        gs.error(gs.getMessage(\"Something went wrong!\"));\n    }\n\n    // Browse specific data, not required for search\n    data.sortOptions = input ? input.sortOptions : sortOptions;\n    data.sortBy = options && options.sortby ? options.sortby : data.sortOptions[0].id;\n    data.noContentMessage = '';\n    data.excludeList = [];\n    data.filterOptions = input ? input.filterOptions : getContentConfiguration();\n    data.filterBy = '';\n    data.view = \"card\";\n    data.featuredContent = [];\n    data.content = [];\n\n    if (!data.in_context) {\n        var preferencesObj = gs.getSession().getClientData(\"preferences\");\n        if (preferencesObj) {\n            var topic = JSON.parse(preferencesObj).topic;\n            var userId = JSON.parse(preferencesObj).userId;\n            data.in_context = (topic === data.sys_id) && (userId == gs.getUserID());\n        }\n        if (!data.in_context)\n            gs.getSession().putClientData('preferences', null);\n    }\n    if (data.in_context) {\n        var usersPreference = gs.getSession().getClientData(\"preferences\");\n        if (usersPreference) {\n            data.sortBy = JSON.parse(usersPreference).sort;\n            if (data.profileLang != 'en') {\n                data.sortBy = \"popularity\";\n            }\n            data.filterBy = JSON.parse(usersPreference).filter;\n            data.view = JSON.parse(usersPreference).view;\n        }\n    }\n    try {\n        var topicJs = new sn_taxonomy.Topic(data.sys_id);\n        data.title = gs.getMessage(\"Browse {0}\", topicJs.getName());\n        data.topicName = topicJs.getName();\n        data.mobileNoContentMessage = gs.getMessage(\"<p>Choose a {0} topic to get more specific support.</p>\", topicJs.getName());\n        //override with input values. \n        if (input) {\n            data.sortBy = input.sortBy || data.sortBy;\n            data.filterBy = input.filterBy || '';\n            data.view = input.view || data.view;\n            //Session cannot store objects, only Strings\n            var preferences = JSON.stringify({\n                filter: data.filterBy,\n                sort: data.sortBy,\n                view: data.view,\n                topic: data.sys_id,\n                userId: gs.getUserID()\n            });\n            gs.getSession().putClientData('preferences', preferences); // Preferences should be retained in-context only.\n            if (input.action === actions.storeView) {\n                data.content = input.content;\n                return;\n            }\n            //if user clicks show more exlude the existing featured content normal content.\n            if (input.action === actions.showMore) {\n                if (input.content.length > 0) {\n                    data.excludeList = getContentIdList(input.content);\n                    data.content = input.content;\n                }\n                if (input.featuredContent.length > 0) {\n                    var exclude = getContentIdList(input.featuredContent);\n                    data.featuredContent = input.featuredContent;\n                    data.excludeList = data.excludeList.concat(exclude);\n                }\n\n            }\n        }\n        // do not fetch featured content on show more action\n        if (!input || input.action !== actions.showMore) {\n            var taxonomyUtil = new global.TaxonomyPortalUtil();\n            var featuredContentCount = parseInt(gs.getProperty(\"taxonomy.content.featured_content_limit\", \"5\"));\n            data.featuredContent = new TopicServiceUtil().getFeaturedContent(data.sys_id, featuredContentCount, data.isMobileApp, data.filterBy);\n            var featuredExcludeContent = getContentIdList(data.featuredContent);\n            data.featuredContent = data.featuredContent.map(function(a) {\n                a.isFeatured = true;\n                return a;\n            });\n            addContentWidget(data.featuredContent);\n            data.excludeList = data.excludeList.concat(featuredExcludeContent);\n            // remove the featured content fetched length from limit so that it gets required limit set by customer.\n            data.limit = data.limit - featuredExcludeContent.length;\n        }\n\n        var filterOptions = data.filterOptions.map(function(filter) {\n            return filter.sysId;\n        });\n\n        if (data.filterBy) {\n            filterOptions = [data.filterBy];\n        }\n\n        var content = getContentForTopic(data.limit, data.isMobileApp, data.excludeList, filterOptions);\n\n        //Check if the length of content is same as limit then show \"show more button\"\n        if (data.limit + 1 === content.length) {\n            data.showMore = true;\n            data.showMoreMsg = gs.getMessage(\"Show more\");\n            content.splice(content.length - 1, 1);\n        } else {\n            data.showMore = false;\n        }\n\n        //Created Content widgets and addes them to content object\n        addContentWidget(content);\n\n        data.content = content;\n\n        if (!gs.nil(data.filterBy) && data.content.length === 0) {\n            var selectedFilterName = getSelectedFilterName(data.filterBy);\n            data.noContentMessage = gs.getMessage(\"<h4 class=\\\"no-content-msg\\\">No results for <b>{0}</b></h4>\", selectedFilterName);\n        }\n\n    } catch (ex) {\n        gs.error(gs.getMessage(\"Invalid Topic Id.\"));\n    }\n\n    function getContentForTopic(limit, isMobile, excludeItems, contentConfigIds) {\n        var includeChildTopics = true;\n        if ((isMobile && gs.getProperty('sn_ex_sp.u_allow.rollup.mesp') === 'false') || options.content_displayed_from === 'Current topic only') {\n            includeChildTopics = false;\n        }\n        limit = limit + 1;\n        if (data.sortBy === \"popularity\")\n            return new TopicServiceUtil().getContentByPopularity(data.sys_id, includeChildTopics, limit, isMobile, excludeItems, contentConfigIds);\n        else\n            return new TopicServiceUtil().getContent(data.sys_id, includeChildTopics, limit, isMobile, excludeItems, contentConfigIds);\n    }\n\n    function getContentConfiguration() {\n        var configurations = [{\n            sysId: \"\",\n            name: gs.getMessage(\"All\", \"All\")\n        }];\n        var contentConfigurationGr = new GlideRecord(\"taxonomy_content_configuration\");\n        contentConfigurationGr.addActiveQuery();\n        contentConfigurationGr.query();\n        while (contentConfigurationGr.next()) {\n            if (!isContentConfigValid(contentConfigurationGr))\n                continue;\n            var configuration = {};\n            configuration.sysId = contentConfigurationGr.getUniqueValue();\n            configuration.name = getFilterName(contentConfigurationGr.content_table);\n            if (configuration.name)\n                configurations.push(configuration);\n        }\n        return configurations;\n    }\n\n    function getFilterName(table) {\n        var content_table_filter_map = {\n            'sc_cat_item': REQUESTS,\n            'kb_knowledge': ARTICLES,\n            'sn_lc_course_item': COURSES\n        };\n        return content_table_filter_map[table];\n    }\n\n    function getContentIdList(content) {\n        return content.map(function(a) {\n            return a.content;\n        });\n    }\n\n    function getSelectedFilterName(sysId) {\n        var selectedFilter = data.filterOptions.filter(function(filter) {\n            return filter.sysId === sysId;\n        });\n        return selectedFilter.length > 0 ? selectedFilter[0].name : '';\n    }\n\n    function addContentWidget(content) {\n        var displayedItemsCount = input && input.focusIndex || 0;\n        content.map(function(a, index) {\n            a.widgetTitle = data.title;\n            a.topicForBreadcrumb = data.sys_id;\n            a.index = displayedItemsCount + index + 1;\n            a.widgetData = $sp.getWidget(data.contentTableToWidget[a.content_table], a);\n        });\n    }\n\n    function postProcessAISResponse(item) {\n        item.content_table = item.table;\n        item.content = item.sysId;\n        item.sys_id = item.sysId;\n        item.searchModeEnabled = true;\n        item.topicForBreadcrumb = data.sys_id;\n        item.columns.forEach(function(col) {\n            var key = col.fieldName;\n            var displayVal = col.displayValue;\n            item[key] = displayVal;\n        });\n\n        switch (item.table) {\n            case 'sc_cat_item': {\n                item.short_description = item.text;\n                item.show_price = item.price ? true : false;\n                item.name = item.title ? item.title : item.name;\n                break;\n            }\n            default:\n                break;\n        }\n\n        return item;\n    }\n\n    function getSearchConfigParams(search_app_sys_id, filters) {\n        var relatedListsTables = [{\n                table_name: 'sys_search_filter',\n                data_key: 'filter',\n                data_column_label: 'label'\n            },\n            {\n                table_name: 'sys_search_sort_option',\n                data_key: 'sort',\n                data_column_label: 'gui_label'\n            },\n        ];\n\n        relatedListsTables.forEach(function(table) {\n            var listGR = new GlideRecord(table.table_name);\n            listGR.addQuery('search_context_config', search_app_sys_id);\n            if (table.table_name === 'sys_search_filter' && filters && filters.length > 0) {\n                listGR.addQuery('sys_id', 'IN', filters.join(','));\n            }\n            listGR.query();\n            while (listGR.next()) {\n                var uniqueID = listGR.getUniqueValue();\n                createAISFilterSortOptions(table.table_name, uniqueID, listGR.getValue(table.data_column_label));\n            }\n        });\n\n        data.ui.aisFacetFilters = getFacetFilters(data.sys_id);\n    }\n\n    function createAISFilterSortOptions(table_name, uniqueID, label) {\n        if (table_name === \"sys_search_filter\") {\n            data.ui.aisSearchFilters.push({\n                sysId: uniqueID,\n                label: label\n            });\n        } else if (table_name === \"sys_search_sort_option\") {\n            data.ui.aisSortOptions.push({\n                sysId: uniqueID,\n                label: label\n            });\n        }\n    }\n\n    function getFacetFilters(topicId) {\n        var topicGR = new GlideRecord('topic');\n        var topicPath = '',\n            currentTopicName = '';\n        if (topicGR.get(topicId)) {\n            topicPath = topicGR.getDisplayValue('topic_path');\n            currentTopicName = topicGR.getDisplayValue('name');\n            data.title = gs.getMessage(\"Browse {0}\", currentTopicName);\n        }\n        var topic_level = topicPath ? topicPath.split('/').length - 1 : 0;\n\n        var facetFields = ['_kb_knowledge.topic_level_', '_sc_cat_item.topic_level_', '_sn_lc_course_item.topic_level_'];\n        var facetFieldsMobile = ['_kb_knowledge', '_sc_cat_item', '_sn_lc_course_item'];\n\n        if ((!data.isMobileApp || gs.getProperty('sn_ex_sp.u_allow.rollup.mesp') === 'true') && options.content_displayed_from === 'Current topic and all child topics') {\n            return [('\"UNION(' + facetFields.map(function(f) {\n                return f + topic_level + '_s';\n            }).join(',') + ')\"' + ':FACET(\"' + currentTopicName + '\")')];\n        }\n\n        return [('\"UNION(' + facetFieldsMobile.map(function(f) {\n            return f + '.topic_path_s';\n        }).join(',') + ')\"' + ':FACET(\"' + topicPath + '\")')];\n    }\n\n    function isContentConfigValid(contentConfigGr) {\n        var connectedContentGr = new GlideRecord('m2m_connected_content');\n        if (connectedContentGr.isValidField(contentConfigGr.getValue('content_reference_field')))\n            return true;\n\n        return false;\n    }\n    return data;\n})();",
            "readonly": false,
            "hint": "",
            "name": "script",
            "attributes": {},
            "choice": 0,
            "value": "(function() {\n    var portalRecord = $sp.getPortalRecord();\n    data.widgetInstance = $sp.getValue('sys_id');\n    data.showEmptyState = options.show_empty_state ? options.show_empty_state : 'true';\n    data.EVENTS = new sn_ex_sp.ContentSearchUtils().getInstanceEvents(data.widgetInstance);\n    data.aisEnabledUtah = gs.getProperty('taxonomy.aisearch.enabled.utah') == 'true' && $sp.isAISearchEnabled();\n    var ais = new sn_ais.StatusApi();\n    data.aisEnabledUtahMobile = gs.getProperty('taxonomy.aisearch.enabled.utah') == 'true' && ais.isAisEnabled() && ais.isAisInitialized();\n    data.mespEmptyStateImage = new sn_ex_sp.TopicPageUtil().getDBImage(\"sn_ex_sp.MESP_empty_state_image_used.png\");\n    data.profileLang = gs.getSession().getLanguage();\n    data.sys_id = $sp.getParameter('topic_id');\n    data.in_context = $sp.getParameter('in_context');\n    data.sys_id = gs.nil(data.sys_id) ? '-1' : data.sys_id;\n    data.limit = parseInt(options.limit) || 12;\n    data.widgetTitle = options && options.title ? gs.getMessage(options.title) : gs.getMessage(\"Support resources\");\n    // change this to use native mobile script to identify is mobile.\n    data.isMobile = gs.isMobile();\n    data.isMobileApp = $sp.getParameter('view') === 'mobile';\n    if (data.isMobileApp) {\n        data.limit = 5;\n    }\n    data.isLearningUpdated = GlidePluginManager.isActive('sn_lc');\n    data.contentTableToWidget = {\n        'sc_cat_item': 'catalog-content',\n        'kb_knowledge': 'kb-content'\n    };\n    if (data.isLearningUpdated) {\n        data.contentTableToWidget.sn_lc_course_item = 'learning-content';\n    }\n\n    //Employee Browser Extensioon Integration \t\n    data.isECBEInstalled = GlidePluginManager.isActive('com.snc.ex_browser_extension');\n    data.isECBEPortal = false;\n    var ecbeUtils;\n    if (data.isECBEInstalled) {\n        ecbeUtils = new sn_ex_brw_ext.ECBEUtil();\n        data.isECBEPortal = ecbeUtils.isECBEPortal($sp);\n\tif (data.isECBEPortal) {\n\t\tvar currentWebsiteObject = ecbeUtils.fetchWebsiteFromSession(); \n\t\tdata.currentWebsite = gs.nil(currentWebsiteObject.website)? null:currentWebsiteObject.website;\n\t}\t\t\n    }\n\n    var sortOptions = [{\n        id: \"popularity\",\n        name: gs.getMessage(\"Popular\", \"Popular\")\n    }, {\n        id: \"alphabetical\",\n        name: gs.getMessage(\"A-Z\", \"A-Z\")\n    }];\n    var actions = {\n        showMore: \"show-more\",\n        filter: \"filter\",\n        sort: \"sort\",\n        storeView: \"storeView\",\n        modifyAISResults: \"modify-ais-results\"\n    };\n    var REQUESTS = sn_i18n.Message.getMessage(\"sn_ex_sp\", \"Requests\");\n    var ARTICLES = gs.getMessage(\"Articles\");\n    var COURSES = gs.getMessage(\"Courses\");\n    data.showRedirectToGlobal = options.show_global_redirect === 'true';\n\n    // AIS content search integration\n    data.clearSearchBtn = gs.getMessage(\"Reset search\");\n    data.btnTitle = gs.getMessage(\"Search button\");\n    data.placeholder = gs.getMessage(\"Search resources\");\n    data.expandSearchMsg = gs.getMessage(\"Didn't find what you're looking for?\");\n    data.expandSearchLink = gs.getMessage(\"Expand your search\");\n    data.searchAppConfigId = portalRecord.getValue('search_application');\n\n    try {\n        var search_app_sys_id = options.search_application || data.searchAppConfigId;\n        var filters = \"\";\n        data.ui = {\n            aisFacetFilters: [],\n            aisSearchFilters: [],\n            aisSortOptions: []\n        };\n        var searchConfig = new sn_ex_sp.TopicPageUtil().getSearchConfiguration(portalRecord.getUniqueValue(), data.widgetInstance);\n        if (searchConfig) {\n            search_app_sys_id = searchConfig.searchApplication;\n            data.search_sources_filter = searchConfig.searchFilters;\n            filters = searchConfig.searchFilters;\n            getSearchConfigParams(search_app_sys_id, filters);\n        } else {\n            getSearchConfigParams(search_app_sys_id);\n            var defaultSearchFilters = options.search_sources_filter || '';\n            data.search_sources_filter = defaultSearchFilters.split(',');\n            filters = defaultSearchFilters ? defaultSearchFilters.split(',') : data.ui.aisSearchFilters.map(function(f) {\n                return f.sysId;\n            });\n        }\n        data.searchWidgetInitOptions = {\n            'facet': JSON.stringify(data.ui.aisFacetFilters).replaceAll('\\\\\"', '\\\\\\\\\\\\\\\\\"').replaceAll('\"', '\\\\\\\\\\\\\"'),\n            'filter': JSON.stringify(filters).replaceAll('\"', '\\\\\\\\\\\\\"'),\n            'sort': JSON.stringify([]).replaceAll('\"', '\\\\\\\\\\\\\"'),\n            'searchConfigId': search_app_sys_id,\n            'btnTitle': data.btnTitle,\n            'placeholder': data.placeholder,\n            'parentWidgetInstance': data.widgetInstance,\n            'isMobileApp': data.isMobileApp\n        };\n\n        if (data.isMobileApp) {\n            data.searchWidgetInitOptions.disableSpellCheck = true;\n        }\n\n        //if user does a search\n        if (input && input.action === actions.modifyAISResults) {\n            data.modifiedAISResponse = input.aisSearchResults.map(function(item) {\n                item = postProcessAISResponse(item);\n                return item;\n            });\n            addContentWidget(data.modifiedAISResponse);\n            // initializing preferences object\n            var preferences = JSON.stringify({\n                filter: input.filterBy || '',\n                sort: input.sortBy || data.sortBy,\n                view: input.view || data.view,\n                topic: data.sys_id,\n                userId: gs.getUserID()\n            });\n            var preferencesObj = gs.getSession().getClientData(\"preferences\");\n            if (!preferencesObj) {\n                gs.getSession().putClientData('preferences', preferences);\n            }\n            return;\n        }\n    } catch (err) {\n        gs.error(gs.getMessage(\"Something went wrong!\"));\n    }\n\n    // Browse specific data, not required for search\n    data.sortOptions = input ? input.sortOptions : sortOptions;\n    data.sortBy = options && options.sortby ? options.sortby : data.sortOptions[0].id;\n    data.noContentMessage = '';\n    data.excludeList = [];\n    data.filterOptions = input ? input.filterOptions : getContentConfiguration();\n    data.filterBy = '';\n    data.view = \"card\";\n    data.featuredContent = [];\n    data.content = [];\n\n    if (!data.in_context) {\n        var preferencesObj = gs.getSession().getClientData(\"preferences\");\n        if (preferencesObj) {\n            var topic = JSON.parse(preferencesObj).topic;\n            var userId = JSON.parse(preferencesObj).userId;\n            data.in_context = (topic === data.sys_id) && (userId == gs.getUserID());\n        }\n        if (!data.in_context)\n            gs.getSession().putClientData('preferences', null);\n    }\n    if (data.in_context) {\n        var usersPreference = gs.getSession().getClientData(\"preferences\");\n        if (usersPreference) {\n            data.sortBy = JSON.parse(usersPreference).sort;\n            if (data.profileLang != 'en') {\n                data.sortBy = \"popularity\";\n            }\n            data.filterBy = JSON.parse(usersPreference).filter;\n            data.view = JSON.parse(usersPreference).view;\n        }\n    }\n    try {\n        var topicJs = new sn_taxonomy.Topic(data.sys_id);\n        data.title = gs.getMessage(\"Browse {0}\", topicJs.getName());\n        data.topicName = topicJs.getName();\n        data.mobileNoContentMessage = gs.getMessage(\"<p>Choose a {0} topic to get more specific support.</p>\", topicJs.getName());\n        //override with input values. \n        if (input) {\n            data.sortBy = input.sortBy || data.sortBy;\n            data.filterBy = input.filterBy || '';\n            data.view = input.view || data.view;\n            //Session cannot store objects, only Strings\n            var preferences = JSON.stringify({\n                filter: data.filterBy,\n                sort: data.sortBy,\n                view: data.view,\n                topic: data.sys_id,\n                userId: gs.getUserID()\n            });\n            gs.getSession().putClientData('preferences', preferences); // Preferences should be retained in-context only.\n            if (input.action === actions.storeView) {\n                data.content = input.content;\n                return;\n            }\n            //if user clicks show more exlude the existing featured content normal content.\n            if (input.action === actions.showMore) {\n                if (input.content.length > 0) {\n                    data.excludeList = getContentIdList(input.content);\n                    data.content = input.content;\n                }\n                if (input.featuredContent.length > 0) {\n                    var exclude = getContentIdList(input.featuredContent);\n                    data.featuredContent = input.featuredContent;\n                    data.excludeList = data.excludeList.concat(exclude);\n                }\n\n            }\n        }\n        // do not fetch featured content on show more action\n        if (!input || input.action !== actions.showMore) {\n            var taxonomyUtil = new global.TaxonomyPortalUtil();\n            var featuredContentCount = parseInt(gs.getProperty(\"taxonomy.content.featured_content_limit\", \"5\"));\n            data.featuredContent = new TopicServiceUtil().getFeaturedContent(data.sys_id, featuredContentCount, data.isMobileApp, data.filterBy);\n            var featuredExcludeContent = getContentIdList(data.featuredContent);\n            data.featuredContent = data.featuredContent.map(function(a) {\n                a.isFeatured = true;\n                return a;\n            });\n            addContentWidget(data.featuredContent);\n            data.excludeList = data.excludeList.concat(featuredExcludeContent);\n            // remove the featured content fetched length from limit so that it gets required limit set by customer.\n            data.limit = data.limit - featuredExcludeContent.length;\n        }\n\n        var filterOptions = data.filterOptions.map(function(filter) {\n            return filter.sysId;\n        });\n\n        if (data.filterBy) {\n            filterOptions = [data.filterBy];\n        }\n\n        var content = getContentForTopic(data.limit, data.isMobileApp, data.excludeList, filterOptions);\n\n        //Check if the length of content is same as limit then show \"show more button\"\n        if (data.limit + 1 === content.length) {\n            data.showMore = true;\n            data.showMoreMsg = gs.getMessage(\"Show more\");\n            content.splice(content.length - 1, 1);\n        } else {\n            data.showMore = false;\n        }\n\n        //Created Content widgets and addes them to content object\n        addContentWidget(content);\n\n        data.content = content;\n\n        if (!gs.nil(data.filterBy) && data.content.length === 0) {\n            var selectedFilterName = getSelectedFilterName(data.filterBy);\n            data.noContentMessage = gs.getMessage(\"<h4 class=\\\"no-content-msg\\\">No results for <b>{0}</b></h4>\", selectedFilterName);\n        }\n\n    } catch (ex) {\n        gs.error(gs.getMessage(\"Invalid Topic Id.\"));\n    }\n\n    function getContentForTopic(limit, isMobile, excludeItems, contentConfigIds) {\n        var includeChildTopics = true;\n        if ((isMobile && gs.getProperty('sn_ex_sp.u_allow.rollup.mesp') === 'false') || options.content_displayed_from === 'Current topic only') {\n            includeChildTopics = false;\n        }\n        limit = limit + 1;\n        if (data.sortBy === \"popularity\")\n            return new TopicServiceUtil().getContentByPopularity(data.sys_id, includeChildTopics, limit, isMobile, excludeItems, contentConfigIds);\n        else\n            return new TopicServiceUtil().getContent(data.sys_id, includeChildTopics, limit, isMobile, excludeItems, contentConfigIds);\n    }\n\n    function getContentConfiguration() {\n        var configurations = [{\n            sysId: \"\",\n            name: gs.getMessage(\"All\", \"All\")\n        }];\n        var contentConfigurationGr = new GlideRecord(\"taxonomy_content_configuration\");\n        contentConfigurationGr.addActiveQuery();\n        contentConfigurationGr.query();\n        while (contentConfigurationGr.next()) {\n            if (!isContentConfigValid(contentConfigurationGr))\n                continue;\n            var configuration = {};\n            configuration.sysId = contentConfigurationGr.getUniqueValue();\n            configuration.name = getFilterName(contentConfigurationGr.content_table);\n            if (configuration.name)\n                configurations.push(configuration);\n        }\n        return configurations;\n    }\n\n    function getFilterName(table) {\n        var content_table_filter_map = {\n            'sc_cat_item': REQUESTS,\n            'kb_knowledge': ARTICLES,\n            'sn_lc_course_item': COURSES\n        };\n        return content_table_filter_map[table];\n    }\n\n    function getContentIdList(content) {\n        return content.map(function(a) {\n            return a.content;\n        });\n    }\n\n    function getSelectedFilterName(sysId) {\n        var selectedFilter = data.filterOptions.filter(function(filter) {\n            return filter.sysId === sysId;\n        });\n        return selectedFilter.length > 0 ? selectedFilter[0].name : '';\n    }\n\n    function addContentWidget(content) {\n        var displayedItemsCount = input && input.focusIndex || 0;\n        content.map(function(a, index) {\n            a.widgetTitle = data.title;\n            a.topicForBreadcrumb = data.sys_id;\n            a.index = displayedItemsCount + index + 1;\n            a.widgetData = $sp.getWidget(data.contentTableToWidget[a.content_table], a);\n        });\n    }\n\n    function postProcessAISResponse(item) {\n        item.content_table = item.table;\n        item.content = item.sysId;\n        item.sys_id = item.sysId;\n        item.searchModeEnabled = true;\n        item.topicForBreadcrumb = data.sys_id;\n        item.columns.forEach(function(col) {\n            var key = col.fieldName;\n            var displayVal = col.displayValue;\n            item[key] = displayVal;\n        });\n\n        switch (item.table) {\n            case 'sc_cat_item': {\n                item.short_description = item.text;\n                item.show_price = item.price ? true : false;\n                item.name = item.title ? item.title : item.name;\n                break;\n            }\n            default:\n                break;\n        }\n\n        return item;\n    }\n\n    function getSearchConfigParams(search_app_sys_id, filters) {\n        var relatedListsTables = [{\n                table_name: 'sys_search_filter',\n                data_key: 'filter',\n                data_column_label: 'label'\n            },\n            {\n                table_name: 'sys_search_sort_option',\n                data_key: 'sort',\n                data_column_label: 'gui_label'\n            },\n        ];\n\n        relatedListsTables.forEach(function(table) {\n            var listGR = new GlideRecord(table.table_name);\n            listGR.addQuery('search_context_config', search_app_sys_id);\n            if (table.table_name === 'sys_search_filter' && filters && filters.length > 0) {\n                listGR.addQuery('sys_id', 'IN', filters.join(','));\n            }\n            listGR.query();\n            while (listGR.next()) {\n                var uniqueID = listGR.getUniqueValue();\n                createAISFilterSortOptions(table.table_name, uniqueID, listGR.getValue(table.data_column_label));\n            }\n        });\n\n        data.ui.aisFacetFilters = getFacetFilters(data.sys_id);\n    }\n\n    function createAISFilterSortOptions(table_name, uniqueID, label) {\n        if (table_name === \"sys_search_filter\") {\n            data.ui.aisSearchFilters.push({\n                sysId: uniqueID,\n                label: label\n            });\n        } else if (table_name === \"sys_search_sort_option\") {\n            data.ui.aisSortOptions.push({\n                sysId: uniqueID,\n                label: label\n            });\n        }\n    }\n\n    function getFacetFilters(topicId) {\n        var topicGR = new GlideRecord('topic');\n        var topicPath = '',\n            currentTopicName = '';\n        if (topicGR.get(topicId)) {\n            topicPath = topicGR.getDisplayValue('topic_path');\n            currentTopicName = topicGR.getDisplayValue('name');\n            data.title = gs.getMessage(\"Browse {0}\", currentTopicName);\n        }\n        var topic_level = topicPath ? topicPath.split('/').length - 1 : 0;\n\n        var facetFields = ['_kb_knowledge.topic_level_', '_sc_cat_item.topic_level_', '_sn_lc_course_item.topic_level_'];\n        var facetFieldsMobile = ['_kb_knowledge', '_sc_cat_item', '_sn_lc_course_item'];\n\n        if ((!data.isMobileApp || gs.getProperty('sn_ex_sp.u_allow.rollup.mesp') === 'true') && options.content_displayed_from === 'Current topic and all child topics') {\n            return [('\"UNION(' + facetFields.map(function(f) {\n                return f + topic_level + '_s';\n            }).join(',') + ')\"' + ':FACET(\"' + currentTopicName + '\")')];\n        }\n\n        return [('\"UNION(' + facetFieldsMobile.map(function(f) {\n            return f + '.topic_path_s';\n        }).join(',') + ')\"' + ':FACET(\"' + topicPath + '\")')];\n    }\n\n    function isContentConfigValid(contentConfigGr) {\n        var connectedContentGr = new GlideRecord('m2m_connected_content');\n        if (connectedContentGr.isValidField(contentConfigGr.getValue('content_reference_field')))\n            return true;\n\n        return false;\n    }\n    return data;\n})();",
            "max_length": 65000,
            "ed": {
                "name": "script"
            }
        },
        "has_preview": {
            "sys_mandatory": false,
            "visible": true,
            "dbType": -7,
            "label": "Has preview",
            "sys_readonly": false,
            "type": "boolean",
            "mandatory": false,
            "displayValue": "false",
            "readonly": false,
            "hint": "Defines whether preview data is available",
            "name": "has_preview",
            "attributes": {},
            "choice": 0,
            "value": "false",
            "max_length": 40,
            "ed": {
                "name": "has_preview"
            }
        },
        "public": {
            "sys_mandatory": false,
            "visible": true,
            "dbType": -7,
            "label": "Public",
            "sys_readonly": false,
            "type": "boolean",
            "mandatory": false,
            "displayValue": "false",
            "readonly": false,
            "hint": "Widget publicly available to unauthenticated users",
            "name": "public",
            "attributes": {
                "update_exempt": "true"
            },
            "choice": 0,
            "value": "false",
            "max_length": 40,
            "ed": {
                "name": "public"
            }
        },
        "docs": {
            "sys_mandatory": false,
            "visible": true,
            "table_attributes": {
                "update_synch": "true",
                "synch_attachments": "true"
            },
            "dbType": 12,
            "label": "Docs",
            "sys_readonly": false,
            "type": "reference",
            "mandatory": false,
            "refTable": "sp_documentation",
            "reference_type": "table",
            "displayValue": "",
            "readonly": false,
            "hint": "",
            "name": "docs",
            "attributes": {
                "encode_utf8": "false"
            },
            "reference_key": "sys_id",
            "readonlyClickthrough": false,
            "choice": 0,
            "value": "",
            "max_length": 32,
            "ed": {
                "reference": "sp_documentation",
                "searchField": "title",
                "defaultOperator": "STARTSWITH",
                "name": "docs"
            }
        },
        "client_script": {
            "sys_mandatory": false,
            "visible": true,
            "dbType": -1,
            "label": "Client controller",
            "sys_readonly": false,
            "type": "script",
            "mandatory": false,
            "displayValue": "api.controller = function($timeout, $rootScope, $scope, $window, snAnalytics, spAriaUtil, i18n) {\n    var c = this;\n    var CARD_VIEW = \"card\";\n    var LIST_VIEW = \"list\";\n    var FLEX_CARD_SELECTOR = '.flex-item-card';\n    var CONTENT_CARD_SELECTOR = c.data.isMobileApp ? '.content-card-mobile' : '.content-card a';\n    var actions = {\n        showMore: \"show-more\",\n        filter: \"filter\",\n        sort: \"sort\",\n        modifyAISResults: \"modify-ais-results\"\n    };\n    $scope.loading = false;\n    $scope.contentItems = [];\n\n    // AIS search integration\n    $scope.isBackFromGlobalSearch = false;\n    $scope.searchAppConfigId = c.options.searchAppSysId;\n    $scope.isSearchModeEnabled = false;\n    $scope.searchedTerm = \"\";\n    $scope.spellCorrectedTerm = \"\";\n    $scope.noOfNewItems = 0;\n    $scope.aisContentItems = [];\n    $scope.aisFilterOptions = [];\n    $scope.aisSortOptions = [];\n    $scope.hasNext = false;\n    $scope.nextIndexMobileSearch = 0;\n    $scope.mobileSearchResCount = 5;\n    $scope.showMoreFlagMobileSearch = false;\n    c.data.getNext = false;\n    c.data.aisFilterBy = '';\n    c.data.aisSortBy = '';\n    c.data.mespEmptyStateImage = \"\";\n    var AIS_EVENTS = c.data.EVENTS;\n\n    $timeout(function() {\n        $scope.populateFilterAndSortOptions(c.data.ui.aisSearchFilters, c.data.ui.aisSortOptions);\n    }, 0, false);\n\n    var aisModeChangeDestroy = $rootScope.$on(AIS_EVENTS.AIS_MODE_CHANGE_EVENT, function(event, data) {\n        $scope.isSearchModeEnabled = data.searchModeEnabled;\n        if (!$scope.isSearchModeEnabled) {\n            $scope.resetAISParams();\n        }\n    });\n\n    var aisLoadingDestroy = $rootScope.$on(AIS_EVENTS.AIS_LOADING_EVENT, function(event, data) {\n        if (data.isAISloading) {\n            $scope.loading = data.isAISloading;\n            if (!data.loadingNext)\n                $scope.aisContentItems = [];\n        }\n\n    });\n\n    var resultsUpdatedDestroy = $rootScope.$on(AIS_EVENTS.AIS_RESULTS_UPDATED_EVENT, function(event, data) {\n        $scope.searchedTerm = data.searchedTerm;\n        $scope.spellCorrectedTerm = data.spellCorrectedTerm;\n        $scope.hasNext = data.hasNext;\n        $scope.populateFilterAndSortOptions(data.filterOptions, data.sortOptions);\n        $scope.modifyAISResultsData(data.results, c.data.action === actions.showMore);\n        $scope.noOfNewItems = data.results.length;\n        c.announceNewItemsAvailable();\n        if (data.results.length === 0) {\n            $scope.loading = false;\n        }\n    });\n\n    c.announceNewItemsAvailable = function() {\n        $scope.newItemsAnnouncement = \"\";\n\n        i18n.getMessage(\"{0} new items available\", function(translatedMsg) {\n            var msg = translatedMsg.withValues([$scope.noOfNewItems]);\n            $scope.newItemsAnnouncement = msg;\n        });\n    };\n\n\n    $scope.populateFilterAndSortOptions = function(allAISFilterOptions, allAISSortOptions) {\n        $scope.aisFilterOptions = [{\n            name: '${All}',\n            sysId: ''\n        }].concat(allAISFilterOptions.filter(function(f) {\n            return c.data.search_sources_filter.includes(f.sysId);\n        }).map(function(item) {\n            return {\n                name: item.label,\n                sysId: item.sysId\n            };\n        }));\n        $scope.aisSortOptions = [{\n            name: '${Most relevant}',\n            id: ''\n        }].concat(allAISSortOptions.map(function(item) {\n            return {\n                name: item.label,\n                id: item.sysId\n            };\n        }));\n    };\n\n    $scope.$on('ngRepeatFinishedContentCards', function(ngRepeatFinishedEvent) {\n        $scope.loading = false;\n    });\n\n    $scope.$on('$destroy', function() {\n        aisModeChangeDestroy();\n        aisLoadingDestroy();\n        resultsUpdatedDestroy();\n    });\n\n    $scope.resetAISParams = function() {\n        $scope.noOfNewItems = 0;\n        $scope.aisContentItems = [];\n        c.data.aisFilterBy = '';\n        c.data.aisSortBy = '';\n        c.data.searchedQuery = '';\n        c.data.searchQuery = '';\n        $window.sessionStorage.removeItem(\"topicSearchPreferences\");\n    };\n\n    $scope.clearSearch = function() {\n        $rootScope.$broadcast(AIS_EVENTS.AIS_MODE_CHANGE_EVENT, {\n            searchModeEnabled: false,\n        });\n        $scope.getUpdatedContent();\n        c.data.filter = JSON.stringify(c.data.search_sources_filter).replaceAll('\"', '\\\\\\\\\\\\\"');\n        $rootScope.$broadcast(AIS_EVENTS.AIS_RESET_FILTERS_FACETS_AND_SORT, c.data);\n        if (c.data.isMobile) {\n            $scope.nextIndexMobileSearch = 0;\n        }\n    };\n\n    $scope.refreshResults = function(searchParams) {\n        if (searchParams) {\n            c.data.searchQuery = searchParams.search_term;\n            c.data.filter = JSON.stringify(searchParams.filter === '' ? c.data.search_sources_filter : [searchParams.filter]).replaceAll('\"', '\\\\\\\\\\\\\"');\n            c.data.sort = JSON.stringify(searchParams.sort === '' ? [] : [searchParams.sort]).replaceAll('\"', '\\\\\\\\\\\\\"');\n            c.data.spellCheck = searchParams.disable_spell_check || false;\n        }\n        $rootScope.$broadcast(AIS_EVENTS.AIS_REFRESH_RESULTS_EVENT, c.data);\n    };\n\n    $scope.getContentItems = function() {\n        if ($scope.isSearchModeEnabled) {\n            $scope.aisContentItems = $scope.aisContentItems.filter(function(results) {\n                return results.table !== \"sys_attachment\";\n            });\n            if (c.data.isMobileApp) {\n                var searchData = $scope.aisContentItems.slice(0, $scope.nextIndexMobileSearch + $scope.mobileSearchResCount);\n                $scope.showMoreFlagMobileSearch = $scope.aisContentItems.length > ($scope.nextIndexMobileSearch + $scope.mobileSearchResCount) || $scope.hasNext;\n                return searchData;\n            }\n            return $scope.aisContentItems;\n        }\n        return $scope.contentItems;\n    };\n\n    $scope.modifyAISResultsData = function(aisSearchResults, isConcat) {\n        c.data.action = actions.modifyAISResults;\n        c.data.aisSearchResults = aisSearchResults;\n        c.data.searchedQuery = $scope.searchedTerm;\n\n        var aisPreferences = JSON.stringify({\n            aisFilterBy: c.data.aisFilterBy,\n            aisSortBy: c.data.aisSortBy,\n            aisSearchQ: c.data.searchedQuery,\n            profileLang: c.data.profileLang\n        });\n        $window.sessionStorage.setItem(\"topicSearchPreferences\", aisPreferences);\n        var focusIndex = $scope.aisContentItems.length;\n        c.data.focusIndex = focusIndex;\n        c.server.update().then(function(response) {\n            if (isConcat) {\n                $scope.aisContentItems = $scope.aisContentItems.concat(response.modifiedAISResponse);\n                $timeout(function() {\n                    $(CONTENT_CARD_SELECTOR).get(focusIndex).focus();\n                }, 100);\n            } else\n                $scope.aisContentItems = response.modifiedAISResponse;\n        });\n    };\n\n    $scope.getExpandSearchURL = function() {\n        var facetFilters = encodeURI(JSON.stringify(c.data.ui.aisFacetFilters));\n        return \"?id=search&spa=1&q=\" + $scope.searchedTerm + \"&disableSpellCheck=false\";\n    };\n\n    $scope.toGlobalSearch = function() {\n        $scope.setSessionData();\n        $window.location.href = $scope.getExpandSearchURL();\n    };\n\n    $scope.setSessionData = function() {\n        var aisSearchParams = {\n            aisSearchQ: $scope.searchedTerm,\n            aisFilterBy: c.data.aisFilterBy,\n            aisSortBy: c.data.aisSortBy,\n        };\n        $window.sessionStorage.setItem(\"aisSearchParams\", JSON.stringify(aisSearchParams));\n    };\n\n    c.createAppseeEvent = function() {\n        var payload = {};\n        payload.name = 'Topic Page Visits';\n        payload.data = {};\n        payload.data['Topic Name'] = c.data.topicName;\n        payload.data['Topic Id'] = c.data.sys_id;\n        if (c.data.isECBEPortal && c.data.currentWebsite)\n            payload.data['Website'] = new URL(c.data.currentWebsite).hostname;\n        snAnalytics.addEvent(payload);\n    };\n\n    if (c.data.sys_id != -1)\n        c.createAppseeEvent();\n\n    if (c.data) {\n        $scope.contentItems = c.data.featuredContent.concat(c.data.content);\n    }\n\n    $scope.loadMore = function() {\n        c.data.action = actions.showMore;\n        var focusIndex = c.data.content.length;\n        if ($scope.isSearchModeEnabled) {\n            if (!c.data.isMobileApp || ($scope.nextIndexMobileSearch + (2 * $scope.mobileSearchResCount) > $scope.aisContentItems.length && $scope.hasNext)) {\n                c.data.getNext = true;\n                $scope.refreshResults();\n            }\n            if (c.data.isMobileApp) {\n                $scope.nextIndexMobileSearch += $scope.mobileSearchResCount;\n            }\n            return;\n        }\n        return $scope.updateContent(actions.showMore, c.data.getNext).then(function() {\n            $timeout(function() {\n                $(CONTENT_CARD_SELECTOR).get(focusIndex).focus();\n            }, 100);\n        });\n    };\n\n    $scope.loadMoreKeydown = function(event) {\n        if (event.which === 32 || event.which === 13) {\n            c.data.action = actions.showMore;\n            event.preventDefault();\n            var focusIndex = c.data.content.length;\n            if ($scope.isSearchModeEnabled) {\n                c.data.getNext = true;\n                $scope.refreshResults();\n                return;\n            }\n            $scope.loadMore().then(function() {\n                $timeout(function() {\n                    $(CONTENT_CARD_SELECTOR).get(focusIndex).focus();\n                }, 100);\n            });\n        }\n    };\n\n    $scope.getLiveFilteredListCount = function() {\n        var contentItemsCount = $scope.contentItems.length;\n        if (contentItemsCount) {\n            spAriaUtil.sendLiveMessage(contentItemsCount + \"${ results found}\");\n        } else {\n            spAriaUtil.sendLiveMessage(\"${No results found}\");\n        }\n    };\n\n    $scope.getUpdatedContent = function() {\n        c.data.action = actions.filter;\n        c.data.getNext = false;\n        if ($scope.isSearchModeEnabled) {\n            var searchParams = {\n                filter: c.data.aisFilterBy,\n                sort: c.data.aisSortBy,\n            };\n            $scope.refreshResults(searchParams);\n            return;\n        }\n        return $scope.updateContent(actions.filter, c.data.getNext);\n    };\n\n    $scope.updateContent = function(action, getNext) {\n        $scope.loading = true;\n        var isShowMore = action === actions.showMore;\n        var input = {\n            \"action\": c.data.action,\n            \"getNext\": c.data.getNext,\n            \"sortOptions\": c.data.sortOptions,\n            \"filterOptions\": c.data.filterOptions,\n            \"filterBy\": c.data.filterBy,\n            \"sortBy\": c.data.sortBy,\n            \"featuredContent\": c.data.featuredContent,\n            \"aisEnabledUtah\": c.data.aisEnabledUtah,\n            \"aisEnabledUtahMobile\": c.data.aisEnabledUtahMobile,\n            \"aisFilterBy\": c.data.aisFilterBy,\n            \"aisSortBy\": c.data.aisSortBy,\n            \"ais_topic_search\": c.data.ais_topic_search,\n            \"btnTitle\": c.data.btnTitle,\n            \"clearSearchBtn\": c.data.clearSearchBtn,\n            \"expandSearchLink\": c.data.expandSearchLink,\n            \"expandSearchMsg\": c.data.expandSearchMsg,\n            \"in_context\": c.data.in_context,\n            \"isLearningUpdated\": c.data.isLearningUpdated,\n            \"isMobile\": c.data.isMobile,\n            \"isMobileApp\": c.data.isMobileApp,\n            \"limit\": c.data.limit,\n            \"mespEmptyStateImage\": c.data.mespEmptyStateImage,\n            \"mobileNoContentMessage\": c.data.mobileNoContentMessage,\n            \"noContentMessage\": c.data.noContentMessage,\n            \"placeholder\": c.data.placeholder,\n            \"profileLang\": c.data.profileLang,\n            \"searchAppConfigId\": c.data.searchAppConfigId,\n            \"searchWidgetInitOptions\": c.data.searchWidgetInitOptions,\n            \"search_sources_filter\": c.data.search_sources_filter,\n            \"sessionRotationTrigger\": c.data.sessionRotationTrigger,\n            \"showMore\": c.data.showMore,\n            \"showMoreMsg\": c.data.showMoreMsg,\n            \"showRedirectToGlobal\": c.data.showRedirectToGlobal,\n            \"sys_id\": c.data.sys_id,\n            \"title\": c.data.title,\n            \"topicName\": c.data.topicName,\n            \"ui\": c.data.ui,\n            \"view\": c.data.view,\n            \"widgetInstance\": c.data.widgetInstance\n        }\n        if (isShowMore) {\n            input.content = c.data.content.map(function(item) {\n                return { content: item.content };\n            });\n        }\n        return $scope.server.get(input).then(function(response) {\n            c.data.content = isShowMore ? c.data.content.concat(response.data.content) : response.data.content;\n            c.data.showMore = response.data.showMore;\n            c.data.showMoreMsg = response.data.showMoreMsg;\n            c.data.noContentMessage = response.data.noContentMessage;\n            c.data.featuredContent = response.data.featuredContent;\n            $scope.contentItems = c.data.featuredContent.concat(c.data.content);\n            $scope.getLiveFilteredListCount();\n            $scope.loading = false;\n        });\n    };\n\n    $scope.changeView = function(view) {\n        //data.view changes to input.view when server.update is called. \n        c.data.view = view;\n        c.data.action = \"storeView\";\n        c.server.update();\n    };\n\n    $scope.switchTab = function($event) {\n        if ($event.which == 13 || $event.which == 32) {\n            $event.stopPropagation();\n            var layout = c.data.view === CARD_VIEW ? LIST_VIEW : CARD_VIEW;\n            $scope.changeView(layout);\n            $('#tab-' + layout).focus();\n        }\n    };\n\n    $scope.isTouchDevice = function() {\n        return ('ontouchstart' in $window);\n    };\n\n    $scope.handleCorrectedSearch = function(term, type) {\n        var searchParams = {\n            search_term: term,\n            filter: c.data.aisFilterBy,\n            sort: c.data.aisSortBy,\n            disable_spell_check: type === 'search-term'\n        };\n        $scope.refreshResults(searchParams);\n    };\n\n    var destroyWidgetWatcher = $scope.$watch(\n        function() {\n            return $(\"[widget = 'widget'][sn-atf-area='AIS Topic Search']\").length;\n        },\n        function(newValue, oldValue) {\n            var searchParams = {};\n\n            function refreshOnLoad(searchParams) {\n                c.data.aisFilterBy = searchParams.filter;\n                c.data.aisSortBy = searchParams.sort;\n                $scope.refreshResults(searchParams);\n                destroyWidgetWatcher();\n            }\n            if (newValue !== oldValue) {\n                if ($window.sessionStorage.getItem('topicSearchPreferences')) {\n                    var inContextSearchParams = $window.sessionStorage.getItem('topicSearchPreferences');\n                    if (inContextSearchParams) {\n                        inContextSearchParams = JSON.parse(inContextSearchParams);\n                        searchParams = {\n                            search_term: inContextSearchParams.aisSearchQ,\n                            filter: inContextSearchParams.aisFilterBy,\n                            sort: inContextSearchParams.aisSortBy,\n                            profileLang: inContextSearchParams.profileLang\n                        };\n                        if (!c.data.in_context || searchParams.profileLang !== c.data.profileLang) {\n                            $window.sessionStorage.removeItem(\"topicSearchPreferences\");\n                        } else\n                            refreshOnLoad(searchParams);\n                    }\n                }\n                if ($window.sessionStorage.getItem('isBackFromGS') === \"true\" && $window.sessionStorage.getItem('aisSearchParams')) {\n                    var aisSearchParams = JSON.parse($window.sessionStorage.getItem('aisSearchParams'));\n                    searchParams = {\n                        search_term: aisSearchParams.aisSearchQ,\n                        filter: aisSearchParams.aisFilterBy,\n                        sort: aisSearchParams.aisSortBy,\n                    };\n                    refreshOnLoad(searchParams);\n                }\n                $window.sessionStorage.removeItem('aisSearchParams');\n                $window.sessionStorage.removeItem('isBackFromGS');\n            }\n        }\n    );\n\n    $window.addEventListener('popstate', function() {\n        $window.sessionStorage.setItem('isBackFromGS', \"true\");\n    });\n\n};",
            "readonly": false,
            "hint": "",
            "name": "client_script",
            "attributes": {
                "client_script": "true"
            },
            "choice": 0,
            "value": "api.controller = function($timeout, $rootScope, $scope, $window, snAnalytics, spAriaUtil, i18n) {\n    var c = this;\n    var CARD_VIEW = \"card\";\n    var LIST_VIEW = \"list\";\n    var FLEX_CARD_SELECTOR = '.flex-item-card';\n    var CONTENT_CARD_SELECTOR = c.data.isMobileApp ? '.content-card-mobile' : '.content-card a';\n    var actions = {\n        showMore: \"show-more\",\n        filter: \"filter\",\n        sort: \"sort\",\n        modifyAISResults: \"modify-ais-results\"\n    };\n    $scope.loading = false;\n    $scope.contentItems = [];\n\n    // AIS search integration\n    $scope.isBackFromGlobalSearch = false;\n    $scope.searchAppConfigId = c.options.searchAppSysId;\n    $scope.isSearchModeEnabled = false;\n    $scope.searchedTerm = \"\";\n    $scope.spellCorrectedTerm = \"\";\n    $scope.noOfNewItems = 0;\n    $scope.aisContentItems = [];\n    $scope.aisFilterOptions = [];\n    $scope.aisSortOptions = [];\n    $scope.hasNext = false;\n    $scope.nextIndexMobileSearch = 0;\n    $scope.mobileSearchResCount = 5;\n    $scope.showMoreFlagMobileSearch = false;\n    c.data.getNext = false;\n    c.data.aisFilterBy = '';\n    c.data.aisSortBy = '';\n    c.data.mespEmptyStateImage = \"\";\n    var AIS_EVENTS = c.data.EVENTS;\n\n    $timeout(function() {\n        $scope.populateFilterAndSortOptions(c.data.ui.aisSearchFilters, c.data.ui.aisSortOptions);\n    }, 0, false);\n\n    var aisModeChangeDestroy = $rootScope.$on(AIS_EVENTS.AIS_MODE_CHANGE_EVENT, function(event, data) {\n        $scope.isSearchModeEnabled = data.searchModeEnabled;\n        if (!$scope.isSearchModeEnabled) {\n            $scope.resetAISParams();\n        }\n    });\n\n    var aisLoadingDestroy = $rootScope.$on(AIS_EVENTS.AIS_LOADING_EVENT, function(event, data) {\n        if (data.isAISloading) {\n            $scope.loading = data.isAISloading;\n            if (!data.loadingNext)\n                $scope.aisContentItems = [];\n        }\n\n    });\n\n    var resultsUpdatedDestroy = $rootScope.$on(AIS_EVENTS.AIS_RESULTS_UPDATED_EVENT, function(event, data) {\n        $scope.searchedTerm = data.searchedTerm;\n        $scope.spellCorrectedTerm = data.spellCorrectedTerm;\n        $scope.hasNext = data.hasNext;\n        $scope.populateFilterAndSortOptions(data.filterOptions, data.sortOptions);\n        $scope.modifyAISResultsData(data.results, c.data.action === actions.showMore);\n        $scope.noOfNewItems = data.results.length;\n        c.announceNewItemsAvailable();\n        if (data.results.length === 0) {\n            $scope.loading = false;\n        }\n    });\n\n    c.announceNewItemsAvailable = function() {\n        $scope.newItemsAnnouncement = \"\";\n\n        i18n.getMessage(\"{0} new items available\", function(translatedMsg) {\n            var msg = translatedMsg.withValues([$scope.noOfNewItems]);\n            $scope.newItemsAnnouncement = msg;\n        });\n    };\n\n\n    $scope.populateFilterAndSortOptions = function(allAISFilterOptions, allAISSortOptions) {\n        $scope.aisFilterOptions = [{\n            name: '${All}',\n            sysId: ''\n        }].concat(allAISFilterOptions.filter(function(f) {\n            return c.data.search_sources_filter.includes(f.sysId);\n        }).map(function(item) {\n            return {\n                name: item.label,\n                sysId: item.sysId\n            };\n        }));\n        $scope.aisSortOptions = [{\n            name: '${Most relevant}',\n            id: ''\n        }].concat(allAISSortOptions.map(function(item) {\n            return {\n                name: item.label,\n                id: item.sysId\n            };\n        }));\n    };\n\n    $scope.$on('ngRepeatFinishedContentCards', function(ngRepeatFinishedEvent) {\n        $scope.loading = false;\n    });\n\n    $scope.$on('$destroy', function() {\n        aisModeChangeDestroy();\n        aisLoadingDestroy();\n        resultsUpdatedDestroy();\n    });\n\n    $scope.resetAISParams = function() {\n        $scope.noOfNewItems = 0;\n        $scope.aisContentItems = [];\n        c.data.aisFilterBy = '';\n        c.data.aisSortBy = '';\n        c.data.searchedQuery = '';\n        c.data.searchQuery = '';\n        $window.sessionStorage.removeItem(\"topicSearchPreferences\");\n    };\n\n    $scope.clearSearch = function() {\n        $rootScope.$broadcast(AIS_EVENTS.AIS_MODE_CHANGE_EVENT, {\n            searchModeEnabled: false,\n        });\n        $scope.getUpdatedContent();\n        c.data.filter = JSON.stringify(c.data.search_sources_filter).replaceAll('\"', '\\\\\\\\\\\\\"');\n        $rootScope.$broadcast(AIS_EVENTS.AIS_RESET_FILTERS_FACETS_AND_SORT, c.data);\n        if (c.data.isMobile) {\n            $scope.nextIndexMobileSearch = 0;\n        }\n    };\n\n    $scope.refreshResults = function(searchParams) {\n        if (searchParams) {\n            c.data.searchQuery = searchParams.search_term;\n            c.data.filter = JSON.stringify(searchParams.filter === '' ? c.data.search_sources_filter : [searchParams.filter]).replaceAll('\"', '\\\\\\\\\\\\\"');\n            c.data.sort = JSON.stringify(searchParams.sort === '' ? [] : [searchParams.sort]).replaceAll('\"', '\\\\\\\\\\\\\"');\n            c.data.spellCheck = searchParams.disable_spell_check || false;\n        }\n        $rootScope.$broadcast(AIS_EVENTS.AIS_REFRESH_RESULTS_EVENT, c.data);\n    };\n\n    $scope.getContentItems = function() {\n        if ($scope.isSearchModeEnabled) {\n            $scope.aisContentItems = $scope.aisContentItems.filter(function(results) {\n                return results.table !== \"sys_attachment\";\n            });\n            if (c.data.isMobileApp) {\n                var searchData = $scope.aisContentItems.slice(0, $scope.nextIndexMobileSearch + $scope.mobileSearchResCount);\n                $scope.showMoreFlagMobileSearch = $scope.aisContentItems.length > ($scope.nextIndexMobileSearch + $scope.mobileSearchResCount) || $scope.hasNext;\n                return searchData;\n            }\n            return $scope.aisContentItems;\n        }\n        return $scope.contentItems;\n    };\n\n    $scope.modifyAISResultsData = function(aisSearchResults, isConcat) {\n        c.data.action = actions.modifyAISResults;\n        c.data.aisSearchResults = aisSearchResults;\n        c.data.searchedQuery = $scope.searchedTerm;\n\n        var aisPreferences = JSON.stringify({\n            aisFilterBy: c.data.aisFilterBy,\n            aisSortBy: c.data.aisSortBy,\n            aisSearchQ: c.data.searchedQuery,\n            profileLang: c.data.profileLang\n        });\n        $window.sessionStorage.setItem(\"topicSearchPreferences\", aisPreferences);\n        var focusIndex = $scope.aisContentItems.length;\n        c.data.focusIndex = focusIndex;\n        c.server.update().then(function(response) {\n            if (isConcat) {\n                $scope.aisContentItems = $scope.aisContentItems.concat(response.modifiedAISResponse);\n                $timeout(function() {\n                    $(CONTENT_CARD_SELECTOR).get(focusIndex).focus();\n                }, 100);\n            } else\n                $scope.aisContentItems = response.modifiedAISResponse;\n        });\n    };\n\n    $scope.getExpandSearchURL = function() {\n        var facetFilters = encodeURI(JSON.stringify(c.data.ui.aisFacetFilters));\n        return \"?id=search&spa=1&q=\" + $scope.searchedTerm + \"&disableSpellCheck=false\";\n    };\n\n    $scope.toGlobalSearch = function() {\n        $scope.setSessionData();\n        $window.location.href = $scope.getExpandSearchURL();\n    };\n\n    $scope.setSessionData = function() {\n        var aisSearchParams = {\n            aisSearchQ: $scope.searchedTerm,\n            aisFilterBy: c.data.aisFilterBy,\n            aisSortBy: c.data.aisSortBy,\n        };\n        $window.sessionStorage.setItem(\"aisSearchParams\", JSON.stringify(aisSearchParams));\n    };\n\n    c.createAppseeEvent = function() {\n        var payload = {};\n        payload.name = 'Topic Page Visits';\n        payload.data = {};\n        payload.data['Topic Name'] = c.data.topicName;\n        payload.data['Topic Id'] = c.data.sys_id;\n        if (c.data.isECBEPortal && c.data.currentWebsite)\n            payload.data['Website'] = new URL(c.data.currentWebsite).hostname;\n        snAnalytics.addEvent(payload);\n    };\n\n    if (c.data.sys_id != -1)\n        c.createAppseeEvent();\n\n    if (c.data) {\n        $scope.contentItems = c.data.featuredContent.concat(c.data.content);\n    }\n\n    $scope.loadMore = function() {\n        c.data.action = actions.showMore;\n        var focusIndex = c.data.content.length;\n        if ($scope.isSearchModeEnabled) {\n            if (!c.data.isMobileApp || ($scope.nextIndexMobileSearch + (2 * $scope.mobileSearchResCount) > $scope.aisContentItems.length && $scope.hasNext)) {\n                c.data.getNext = true;\n                $scope.refreshResults();\n            }\n            if (c.data.isMobileApp) {\n                $scope.nextIndexMobileSearch += $scope.mobileSearchResCount;\n            }\n            return;\n        }\n        return $scope.updateContent(actions.showMore, c.data.getNext).then(function() {\n            $timeout(function() {\n                $(CONTENT_CARD_SELECTOR).get(focusIndex).focus();\n            }, 100);\n        });\n    };\n\n    $scope.loadMoreKeydown = function(event) {\n        if (event.which === 32 || event.which === 13) {\n            c.data.action = actions.showMore;\n            event.preventDefault();\n            var focusIndex = c.data.content.length;\n            if ($scope.isSearchModeEnabled) {\n                c.data.getNext = true;\n                $scope.refreshResults();\n                return;\n            }\n            $scope.loadMore().then(function() {\n                $timeout(function() {\n                    $(CONTENT_CARD_SELECTOR).get(focusIndex).focus();\n                }, 100);\n            });\n        }\n    };\n\n    $scope.getLiveFilteredListCount = function() {\n        var contentItemsCount = $scope.contentItems.length;\n        if (contentItemsCount) {\n            spAriaUtil.sendLiveMessage(contentItemsCount + \"${ results found}\");\n        } else {\n            spAriaUtil.sendLiveMessage(\"${No results found}\");\n        }\n    };\n\n    $scope.getUpdatedContent = function() {\n        c.data.action = actions.filter;\n        c.data.getNext = false;\n        if ($scope.isSearchModeEnabled) {\n            var searchParams = {\n                filter: c.data.aisFilterBy,\n                sort: c.data.aisSortBy,\n            };\n            $scope.refreshResults(searchParams);\n            return;\n        }\n        return $scope.updateContent(actions.filter, c.data.getNext);\n    };\n\n    $scope.updateContent = function(action, getNext) {\n        $scope.loading = true;\n        var isShowMore = action === actions.showMore;\n        var input = {\n            \"action\": c.data.action,\n            \"getNext\": c.data.getNext,\n            \"sortOptions\": c.data.sortOptions,\n            \"filterOptions\": c.data.filterOptions,\n            \"filterBy\": c.data.filterBy,\n            \"sortBy\": c.data.sortBy,\n            \"featuredContent\": c.data.featuredContent,\n            \"aisEnabledUtah\": c.data.aisEnabledUtah,\n            \"aisEnabledUtahMobile\": c.data.aisEnabledUtahMobile,\n            \"aisFilterBy\": c.data.aisFilterBy,\n            \"aisSortBy\": c.data.aisSortBy,\n            \"ais_topic_search\": c.data.ais_topic_search,\n            \"btnTitle\": c.data.btnTitle,\n            \"clearSearchBtn\": c.data.clearSearchBtn,\n            \"expandSearchLink\": c.data.expandSearchLink,\n            \"expandSearchMsg\": c.data.expandSearchMsg,\n            \"in_context\": c.data.in_context,\n            \"isLearningUpdated\": c.data.isLearningUpdated,\n            \"isMobile\": c.data.isMobile,\n            \"isMobileApp\": c.data.isMobileApp,\n            \"limit\": c.data.limit,\n            \"mespEmptyStateImage\": c.data.mespEmptyStateImage,\n            \"mobileNoContentMessage\": c.data.mobileNoContentMessage,\n            \"noContentMessage\": c.data.noContentMessage,\n            \"placeholder\": c.data.placeholder,\n            \"profileLang\": c.data.profileLang,\n            \"searchAppConfigId\": c.data.searchAppConfigId,\n            \"searchWidgetInitOptions\": c.data.searchWidgetInitOptions,\n            \"search_sources_filter\": c.data.search_sources_filter,\n            \"sessionRotationTrigger\": c.data.sessionRotationTrigger,\n            \"showMore\": c.data.showMore,\n            \"showMoreMsg\": c.data.showMoreMsg,\n            \"showRedirectToGlobal\": c.data.showRedirectToGlobal,\n            \"sys_id\": c.data.sys_id,\n            \"title\": c.data.title,\n            \"topicName\": c.data.topicName,\n            \"ui\": c.data.ui,\n            \"view\": c.data.view,\n            \"widgetInstance\": c.data.widgetInstance\n        }\n        if (isShowMore) {\n            input.content = c.data.content.map(function(item) {\n                return { content: item.content };\n            });\n        }\n        return $scope.server.get(input).then(function(response) {\n            c.data.content = isShowMore ? c.data.content.concat(response.data.content) : response.data.content;\n            c.data.showMore = response.data.showMore;\n            c.data.showMoreMsg = response.data.showMoreMsg;\n            c.data.noContentMessage = response.data.noContentMessage;\n            c.data.featuredContent = response.data.featuredContent;\n            $scope.contentItems = c.data.featuredContent.concat(c.data.content);\n            $scope.getLiveFilteredListCount();\n            $scope.loading = false;\n        });\n    };\n\n    $scope.changeView = function(view) {\n        //data.view changes to input.view when server.update is called. \n        c.data.view = view;\n        c.data.action = \"storeView\";\n        c.server.update();\n    };\n\n    $scope.switchTab = function($event) {\n        if ($event.which == 13 || $event.which == 32) {\n            $event.stopPropagation();\n            var layout = c.data.view === CARD_VIEW ? LIST_VIEW : CARD_VIEW;\n            $scope.changeView(layout);\n            $('#tab-' + layout).focus();\n        }\n    };\n\n    $scope.isTouchDevice = function() {\n        return ('ontouchstart' in $window);\n    };\n\n    $scope.handleCorrectedSearch = function(term, type) {\n        var searchParams = {\n            search_term: term,\n            filter: c.data.aisFilterBy,\n            sort: c.data.aisSortBy,\n            disable_spell_check: type === 'search-term'\n        };\n        $scope.refreshResults(searchParams);\n    };\n\n    var destroyWidgetWatcher = $scope.$watch(\n        function() {\n            return $(\"[widget = 'widget'][sn-atf-area='AIS Topic Search']\").length;\n        },\n        function(newValue, oldValue) {\n            var searchParams = {};\n\n            function refreshOnLoad(searchParams) {\n                c.data.aisFilterBy = searchParams.filter;\n                c.data.aisSortBy = searchParams.sort;\n                $scope.refreshResults(searchParams);\n                destroyWidgetWatcher();\n            }\n            if (newValue !== oldValue) {\n                if ($window.sessionStorage.getItem('topicSearchPreferences')) {\n                    var inContextSearchParams = $window.sessionStorage.getItem('topicSearchPreferences');\n                    if (inContextSearchParams) {\n                        inContextSearchParams = JSON.parse(inContextSearchParams);\n                        searchParams = {\n                            search_term: inContextSearchParams.aisSearchQ,\n                            filter: inContextSearchParams.aisFilterBy,\n                            sort: inContextSearchParams.aisSortBy,\n                            profileLang: inContextSearchParams.profileLang\n                        };\n                        if (!c.data.in_context || searchParams.profileLang !== c.data.profileLang) {\n                            $window.sessionStorage.removeItem(\"topicSearchPreferences\");\n                        } else\n                            refreshOnLoad(searchParams);\n                    }\n                }\n                if ($window.sessionStorage.getItem('isBackFromGS') === \"true\" && $window.sessionStorage.getItem('aisSearchParams')) {\n                    var aisSearchParams = JSON.parse($window.sessionStorage.getItem('aisSearchParams'));\n                    searchParams = {\n                        search_term: aisSearchParams.aisSearchQ,\n                        filter: aisSearchParams.aisFilterBy,\n                        sort: aisSearchParams.aisSortBy,\n                    };\n                    refreshOnLoad(searchParams);\n                }\n                $window.sessionStorage.removeItem('aisSearchParams');\n                $window.sessionStorage.removeItem('isBackFromGS');\n            }\n        }\n    );\n\n    $window.addEventListener('popstate', function() {\n        $window.sessionStorage.setItem('isBackFromGS', \"true\");\n    });\n\n};",
            "max_length": 8000,
            "ed": {
                "name": "client_script"
            }
        },
        "data_table": {
            "sys_mandatory": true,
            "visible": true,
            "dbType": 12,
            "default_value": "sp_instance",
            "label": "Data table",
            "sys_readonly": false,
            "type": "table_name",
            "mandatory": true,
            "displayValue": "sp_instance",
            "readonly": false,
            "hint": "",
            "name": "data_table",
            "attributes": {
                "base_table": "sp_instance",
                "base_start": "true"
            },
            "choice": 0,
            "choices": [],
            "value": "sp_instance",
            "max_length": 80,
            "ed": {
                "name": "data_table"
            }
        },
        "name": {
            "sys_mandatory": true,
            "visible": true,
            "dbType": 12,
            "label": "Name",
            "sys_readonly": false,
            "type": "translated_field",
            "mandatory": true,
            "displayValue": "Topic Content clone",
            "readonly": false,
            "hint": "",
            "name": "name",
            "attributes": {},
            "choice": 0,
            "value": "Topic Content clone",
            "max_length": 40,
            "ed": {
                "name": "name"
            }
        },
        "sys_scope": {
            "sys_mandatory": false,
            "visible": true,
            "table_attributes": {
                "metadata_link_exempt": "true"
            },
            "dbType": 12,
            "label": "Application",
            "sys_readonly": true,
            "type": "reference",
            "mandatory": false,
            "refTable": "sys_store_app",
            "reference_type": "table",
            "displayValue": "Employee Center",
            "readonly": true,
            "hint": "Application containing this record",
            "name": "sys_scope",
            "attributes": {
                "list_force_default": "true",
                "readonly_clickthrough": "true",
                "ignore_filter_on_new": "true"
            },
            "reference_key": "sys_id",
            "readonlyClickthrough": true,
            "choice": 0,
            "value": "4249e63a28d54d61bb6fbf61fd86cccb",
            "max_length": 32,
            "ed": {
                "reference": "sys_scope",
                "searchField": "name",
                "defaultOperator": "STARTSWITH",
                "name": "sys_scope"
            }
        },
        "id": {
            "sys_mandatory": false,
            "visible": true,
            "dbType": 12,
            "label": "ID",
            "sys_readonly": false,
            "type": "string",
            "mandatory": false,
            "displayValue": "topic_content_clone",
            "readonly": false,
            "hint": "Identifier for $sp.embedWidget()",
            "name": "id",
            "attributes": {
                "edge_encryption_enabled": "true"
            },
            "choice": 0,
            "value": "topic_content_clone",
            "max_length": 40,
            "ed": {
                "name": "id"
            }
        },
        "field_list": {
            "sys_mandatory": false,
            "visible": true,
            "dependentField": "data_table",
            "dbType": -1,
            "label": "Fields",
            "sys_readonly": false,
            "type": "field_list",
            "mandatory": false,
            "displayValue": "",
            "readonly": false,
            "hint": "",
            "name": "field_list",
            "attributes": {
                "is_multi_text": "false"
            },
            "choice": 0,
            "value": "",
            "max_length": 1000,
            "ed": {
                "dependent_value": "sp_instance",
                "name": "field_list"
            }
        },
        "controller_as": {
            "sys_mandatory": false,
            "visible": true,
            "dbType": 12,
            "label": "controllerAs",
            "sys_readonly": false,
            "type": "string",
            "mandatory": false,
            "displayValue": "c",
            "readonly": false,
            "hint": "Identifier name for a reference to the controller in the directive's scope",
            "name": "controller_as",
            "attributes": {
                "edge_encryption_enabled": "true"
            },
            "choice": 0,
            "value": "c",
            "max_length": 100,
            "ed": {
                "name": "controller_as"
            }
        }
    }
}